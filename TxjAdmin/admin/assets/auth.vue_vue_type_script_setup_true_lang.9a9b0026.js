import{N as S,M as N,C as T,E as M,G as I}from"./element-plus.28f30ed2.js";import{a as L,b as j}from"./role.73ba3037.js";import{m as q}from"./menu.a581b1a2.js";import{p as G}from"./index.1d239a72.js";import{f as H,t as O}from"./index.93d1c242.js";import{d as U,s as p,r,_ as z,o as J,c as P,V as t,M as d,u,a as k,k as Q,n as y}from"./@vue.cb90fff3.js";const W={class:"edit-popup"},le=U({__name:"auth",emits:["success","close"],setup(X,{expose:v,emit:f}){const o=p(),h=p(),m=p(),C=r(!1),c=r(!0),_=r([]),i=r([]),l=z({id:"",name:"",remark:"",sort:0,isDisable:0,menus:[]}),x={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["blur"]}]},b=async()=>{const e=await q();i.value=e,_.value=O(e)},E=()=>{var a,n;const e=(a=o.value)==null?void 0:a.getCheckedKeys(),s=(n=o.value)==null?void 0:n.getHalfCheckedKeys();return e==null||e.unshift.apply(e,s),e},g=()=>{l.menus.forEach(e=>{y(()=>{var s;(s=o.value)==null||s.setChecked(e,!0,!1)})})},F=e=>{const s=i.value;for(let a=0;a<s.length;a++)o.value.store.nodesMap[s[a].id].expanded=e},w=e=>{var s,a;e?(s=o.value)==null||s.setCheckedKeys(_.value.map(n=>n.id)):(a=o.value)==null||a.setCheckedKeys([])},D=async()=>{var e,s;await((e=h.value)==null?void 0:e.validate()),l.menus=E(),await L({...l,menuIds:l.menus.join()}),(s=m.value)==null||s.close(),H.msgSuccess("\u64CD\u4F5C\u6210\u529F"),f("success")},R=()=>{f("close")};return v({open:()=>{var e;(e=m.value)==null||e.open()},setFormData:async e=>{await b();const s=await j({id:e.id});for(const a in l)s[a]!=null&&s[a]!=null&&(l[a]=s[a]);y(()=>{g()})}}),(e,s)=>{const a=S,n=N,B=T,A=M,K=I;return J(),P("div",W,[t(G,{ref_key:"popupRef",ref:m,title:"\u6743\u9650\u8BBE\u7F6E",async:!0,width:"550px",onConfirm:D,onClose:R},{default:d(()=>[t(K,{class:"ls-form",ref_key:"formRef",ref:h,rules:x,model:u(l),"label-width":"60px"},{default:d(()=>[t(A,{class:"h-[400px] sm:h-[600px]"},{default:d(()=>[t(B,{label:"\u6743\u9650",prop:"menus"},{default:d(()=>[k("div",null,[t(a,{label:"\u5C55\u5F00/\u6298\u53E0",onChange:F}),t(a,{label:"\u5168\u9009/\u4E0D\u5168\u9009",onChange:w}),t(a,{modelValue:u(c),"onUpdate:modelValue":s[0]||(s[0]=V=>Q(c)?c.value=V:null),label:"\u7236\u5B50\u8054\u52A8"},null,8,["modelValue"]),k("div",null,[t(n,{ref_key:"treeRef",ref:o,data:u(i),props:{label:"menuName",children:"children"},"check-strictly":!u(c),"node-key":"id","default-expand-all":u(C),"show-checkbox":""},null,8,["data","check-strictly","default-expand-all"])])])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},512)])}}});export{le as _};
