import{Y as J,ag as re,aZ as ie,A as q,ai as y,bt as V,cE as $,v as S,J as he,I as N,b2 as A,r as ue,o as h,m as P,w as R,c as F,F as be,i as ke,n as g,h as t,b3 as de,O as w,q as b,a as j,j as O,b as L,D as U,dB as Ee,t as Y,ab as $e,dC as Ce,dD as we,G as Re,aq as _e,as as Le,cQ as Fe,_ as M,aw as Pe,a1 as W,bo as Q,dE as Se,dF as Ue,a2 as Z,b6 as Oe,y as x,bO as Te,av as De,bA as Be,cp as ee,N as te,R as je}from"./entry.35d4c246.js";import{E as Ne}from"./index.1fc0ea57.js";import{b as qe}from"./_baseClone.43deedb0.js";import{i as Ae}from"./isEqual.97080887.js";var Me=1,He=4;function se(a){return qe(a,Me|He)}const ce=Symbol("uploadContextKey"),Ke="ElUpload";class ze extends Error{constructor(l,s,r,c){super(l),this.name="UploadAjaxError",this.status=s,this.method=r,this.url=c}}function ae(a,l,s){let r;return s.response?r=`${s.response.error||s.response}`:s.responseText?r=`${s.responseText}`:r=`fail to ${l.method} ${a} ${s.status}`,new ze(r,s.status,l.method,a)}function Ie(a){const l=a.responseText||a.response;if(!l)return l;try{return JSON.parse(l)}catch{return l}}const Ge=a=>{typeof XMLHttpRequest>"u"&&J(Ke,"XMLHttpRequest is undefined");const l=new XMLHttpRequest,s=a.action;l.upload&&l.upload.addEventListener("progress",m=>{const p=m;p.percent=m.total>0?m.loaded/m.total*100:0,a.onProgress(p)});const r=new FormData;if(a.data)for(const[m,p]of Object.entries(a.data))re(p)&&p.length?r.append(m,...p):r.append(m,p);r.append(a.filename,a.file,a.file.name),l.addEventListener("error",()=>{a.onError(ae(s,a,l))}),l.addEventListener("load",()=>{if(l.status<200||l.status>=300)return a.onError(ae(s,a,l));a.onSuccess(Ie(l))}),l.open(a.method,s,!0),a.withCredentials&&"withCredentials"in l&&(l.withCredentials=!0);const c=a.headers||{};if(c instanceof Headers)c.forEach((m,p)=>l.setRequestHeader(p,m));else for(const[m,p]of Object.entries(c))ie(p)||l.setRequestHeader(m,String(p));return l.send(r),l},pe=["text","picture","picture-card"];let Ve=1;const X=()=>Date.now()+Ve++,fe=q({action:{type:String,default:"#"},headers:{type:y(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>V({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:y(Array),default:()=>V([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:pe,default:"text"},httpRequest:{type:y(Function),default:Ge},disabled:Boolean,limit:Number}),We=q({...fe,beforeUpload:{type:y(Function),default:$},beforeRemove:{type:y(Function)},onRemove:{type:y(Function),default:$},onChange:{type:y(Function),default:$},onPreview:{type:y(Function),default:$},onSuccess:{type:y(Function),default:$},onProgress:{type:y(Function),default:$},onError:{type:y(Function),default:$},onExceed:{type:y(Function),default:$}}),Xe=q({files:{type:y(Array),default:()=>V([])},disabled:{type:Boolean,default:!1},handlePreview:{type:y(Function),default:$},listType:{type:String,values:pe,default:"text"}}),Je={remove:a=>!!a},Ye=["onKeydown"],Qe=["src"],Ze=["onClick"],xe=["title"],et=["onClick"],tt=["onClick"],st=S({name:"ElUploadList"}),at=S({...st,props:Xe,emits:Je,setup(a,{emit:l}){const{t:s}=he(),r=N("upload"),c=N("icon"),m=N("list"),p=A(),C=ue(!1),k=d=>{l("remove",d)};return(d,E)=>(h(),P(Fe,{tag:"ul",class:g([t(r).b("list"),t(r).bm("list",d.listType),t(r).is("disabled",t(p))]),name:t(m).b()},{default:R(()=>[(h(!0),F(be,null,ke(d.files,f=>(h(),F("li",{key:f.uid||f.name,class:g([t(r).be("list","item"),t(r).is(f.status),{focusing:C.value}]),tabindex:"0",onKeydown:de(o=>!t(p)&&k(f),["delete"]),onFocus:E[0]||(E[0]=o=>C.value=!0),onBlur:E[1]||(E[1]=o=>C.value=!1),onClick:E[2]||(E[2]=o=>C.value=!1)},[w(d.$slots,"default",{file:f},()=>[d.listType==="picture"||f.status!=="uploading"&&d.listType==="picture-card"?(h(),F("img",{key:0,class:g(t(r).be("list","item-thumbnail")),src:f.url,alt:""},null,10,Qe)):b("v-if",!0),f.status==="uploading"||d.listType!=="picture-card"?(h(),F("div",{key:1,class:g(t(r).be("list","item-info"))},[j("a",{class:g(t(r).be("list","item-name")),onClick:O(o=>d.handlePreview(f),["prevent"])},[L(t(U),{class:g(t(c).m("document"))},{default:R(()=>[L(t(Ee))]),_:1},8,["class"]),j("span",{class:g(t(r).be("list","item-file-name")),title:f.name},Y(f.name),11,xe)],10,Ze),f.status==="uploading"?(h(),P(t(Ne),{key:0,type:d.listType==="picture-card"?"circle":"line","stroke-width":d.listType==="picture-card"?6:2,percentage:Number(f.percentage),style:$e(d.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("v-if",!0)],2)):b("v-if",!0),j("label",{class:g(t(r).be("list","item-status-label"))},[d.listType==="text"?(h(),P(t(U),{key:0,class:g([t(c).m("upload-success"),t(c).m("circle-check")])},{default:R(()=>[L(t(Ce))]),_:1},8,["class"])):["picture-card","picture"].includes(d.listType)?(h(),P(t(U),{key:1,class:g([t(c).m("upload-success"),t(c).m("check")])},{default:R(()=>[L(t(we))]),_:1},8,["class"])):b("v-if",!0)],2),t(p)?b("v-if",!0):(h(),P(t(U),{key:2,class:g(t(c).m("close")),onClick:o=>k(f)},{default:R(()=>[L(t(Re))]),_:2},1032,["class","onClick"])),b(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),b(" This is a bug which needs to be fixed "),b(" TODO: Fix the incorrect navigation interaction "),t(p)?b("v-if",!0):(h(),F("i",{key:3,class:g(t(c).m("close-tip"))},Y(t(s)("el.upload.deleteTip")),3)),d.listType==="picture-card"?(h(),F("span",{key:4,class:g(t(r).be("list","item-actions"))},[j("span",{class:g(t(r).be("list","item-preview")),onClick:o=>d.handlePreview(f)},[L(t(U),{class:g(t(c).m("zoom-in"))},{default:R(()=>[L(t(_e))]),_:1},8,["class"])],10,et),t(p)?b("v-if",!0):(h(),F("span",{key:0,class:g(t(r).be("list","item-delete")),onClick:o=>k(f)},[L(t(U),{class:g(t(c).m("delete"))},{default:R(()=>[L(t(Le))]),_:1},8,["class"])],10,tt))],2)):b("v-if",!0)])],42,Ye))),128)),w(d.$slots,"append")]),_:3},8,["class","name"]))}});var oe=M(at,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const ot=q({disabled:{type:Boolean,default:!1}}),nt={file:a=>re(a)},lt=["onDrop","onDragover"],me="ElUploadDrag",rt=S({name:me}),it=S({...rt,props:ot,emits:nt,setup(a,{emit:l}){const s=Pe(ce);s||J(me,"usage: <el-upload><el-upload-dragger /></el-upload>");const r=N("upload"),c=ue(!1),m=A(),p=k=>{if(m.value)return;c.value=!1,k.stopPropagation();const d=Array.from(k.dataTransfer.files),E=s.accept.value;if(!E){l("file",d);return}const f=d.filter(o=>{const{type:i,name:e}=o,u=e.includes(".")?`.${e.split(".").pop()}`:"",n=i.replace(/\/.*$/,"");return E.split(",").map(v=>v.trim()).filter(v=>v).some(v=>v.startsWith(".")?u===v:/\/\*$/.test(v)?n===v.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(v)?i===v:!1)});l("file",f)},C=()=>{m.value||(c.value=!0)};return(k,d)=>(h(),F("div",{class:g([t(r).b("dragger"),t(r).is("dragover",c.value)]),onDrop:O(p,["prevent"]),onDragover:O(C,["prevent"]),onDragleave:d[0]||(d[0]=O(E=>c.value=!1,["prevent"]))},[w(k.$slots,"default")],42,lt))}});var ut=M(it,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const dt=q({...fe,beforeUpload:{type:y(Function),default:$},onRemove:{type:y(Function),default:$},onStart:{type:y(Function),default:$},onSuccess:{type:y(Function),default:$},onProgress:{type:y(Function),default:$},onError:{type:y(Function),default:$},onExceed:{type:y(Function),default:$}}),ct=["onKeydown"],pt=["name","multiple","accept"],ft=S({name:"ElUploadContent",inheritAttrs:!1}),mt=S({...ft,props:dt,setup(a,{expose:l}){const s=a,r=N("upload"),c=A(),m=W({}),p=W(),C=e=>{if(e.length===0)return;const{autoUpload:u,limit:n,fileList:v,multiple:_,onStart:T,onExceed:H}=s;if(n&&v.length+e.length>n){H(e,v);return}_||(e=e.slice(0,1));for(const K of e){const D=K;D.uid=X(),T(D),u&&k(D)}},k=async e=>{if(p.value.value="",!s.beforeUpload)return d(e);let u,n={};try{const _=s.data,T=s.beforeUpload(e);n=Q(s.data)?se(s.data):s.data,u=await T,Q(s.data)&&Ae(_,n)&&(n=se(s.data))}catch{u=!1}if(u===!1){s.onRemove(e);return}let v=e;u instanceof Blob&&(u instanceof File?v=u:v=new File([u],e.name,{type:e.type})),d(Object.assign(v,{uid:e.uid}),n)},d=(e,u)=>{const{headers:n,data:v,method:_,withCredentials:T,name:H,action:K,onProgress:D,onSuccess:ve,onError:ye,httpRequest:ge}=s,{uid:z}=e,I={headers:n||{},withCredentials:T,file:e,data:u??v,method:_,filename:H,action:K,onProgress:B=>{D(B,e)},onSuccess:B=>{ve(B,e),delete m.value[z]},onError:B=>{ye(B,e),delete m.value[z]}},G=ge(I);m.value[z]=G,G instanceof Promise&&G.then(I.onSuccess,I.onError)},E=e=>{const u=e.target.files;u&&C(Array.from(u))},f=()=>{c.value||(p.value.value="",p.value.click())},o=()=>{f()};return l({abort:e=>{Se(m.value).filter(e?([n])=>String(e.uid)===n:()=>!0).forEach(([n,v])=>{v instanceof XMLHttpRequest&&v.abort(),delete m.value[n]})},upload:k}),(e,u)=>(h(),F("div",{class:g([t(r).b(),t(r).m(e.listType),t(r).is("drag",e.drag)]),tabindex:"0",onClick:f,onKeydown:de(O(o,["self"]),["enter","space"])},[e.drag?(h(),P(ut,{key:0,disabled:t(c),onFile:C},{default:R(()=>[w(e.$slots,"default")]),_:3},8,["disabled"])):w(e.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:p,class:g(t(r).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:E,onClick:u[0]||(u[0]=O(()=>{},["stop"]))},null,42,pt)],42,ct))}});var ne=M(mt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const le="ElUpload",vt=a=>{var l;(l=a.url)!=null&&l.startsWith("blob:")&&URL.revokeObjectURL(a.url)},yt=(a,l)=>{const s=Ue(a,"fileList",void 0,{passive:!0}),r=o=>s.value.find(i=>i.uid===o.uid);function c(o){var i;(i=l.value)==null||i.abort(o)}function m(o=["ready","uploading","success","fail"]){s.value=s.value.filter(i=>!o.includes(i.status))}const p=(o,i)=>{const e=r(i);e&&(console.error(o),e.status="fail",s.value.splice(s.value.indexOf(e),1),a.onError(o,e,s.value),a.onChange(e,s.value))},C=(o,i)=>{const e=r(i);e&&(a.onProgress(o,e,s.value),e.status="uploading",e.percentage=Math.round(o.percent))},k=(o,i)=>{const e=r(i);e&&(e.status="success",e.response=o,a.onSuccess(o,e,s.value),a.onChange(e,s.value))},d=o=>{ie(o.uid)&&(o.uid=X());const i={name:o.name,percentage:0,status:"ready",size:o.size,raw:o,uid:o.uid};if(a.listType==="picture-card"||a.listType==="picture")try{i.url=URL.createObjectURL(o)}catch(e){Oe(le,e.message),a.onError(e,i,s.value)}s.value=[...s.value,i],a.onChange(i,s.value)},E=async o=>{const i=o instanceof File?r(o):o;i||J(le,"file to be removed not found");const e=u=>{c(u);const n=s.value;n.splice(n.indexOf(u),1),a.onRemove(u,n),vt(u)};a.beforeRemove?await a.beforeRemove(i,s.value)!==!1&&e(i):e(i)};function f(){s.value.filter(({status:o})=>o==="ready").forEach(({raw:o})=>{var i;return o&&((i=l.value)==null?void 0:i.upload(o))})}return Z(()=>a.listType,o=>{o!=="picture-card"&&o!=="picture"||(s.value=s.value.map(i=>{const{raw:e,url:u}=i;if(!u&&e)try{i.url=URL.createObjectURL(e)}catch(n){a.onError(n,i,s.value)}return i}))}),Z(s,o=>{for(const i of o)i.uid||(i.uid=X()),i.status||(i.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:c,clearFiles:m,handleError:p,handleProgress:C,handleStart:d,handleSuccess:k,handleRemove:E,submit:f}},gt=S({name:"ElUpload"}),ht=S({...gt,props:We,setup(a,{expose:l}){const s=a,r=A(),c=W(),{abort:m,submit:p,clearFiles:C,uploadFiles:k,handleStart:d,handleError:E,handleRemove:f,handleSuccess:o,handleProgress:i}=yt(s,c),e=x(()=>s.listType==="picture-card"),u=x(()=>({...s,fileList:k.value,onStart:d,onProgress:i,onSuccess:o,onError:E,onRemove:f}));return Te(()=>{k.value.forEach(({url:n})=>{n!=null&&n.startsWith("blob:")&&URL.revokeObjectURL(n)})}),De(ce,{accept:Be(s,"accept")}),l({abort:m,submit:p,clearFiles:C,handleStart:d,handleRemove:f}),(n,v)=>(h(),F("div",null,[t(e)&&n.showFileList?(h(),P(oe,{key:0,disabled:t(r),"list-type":n.listType,files:t(k),"handle-preview":n.onPreview,onRemove:t(f)},ee({append:R(()=>[L(ne,te({ref_key:"uploadRef",ref:c},t(u)),{default:R(()=>[n.$slots.trigger?w(n.$slots,"trigger",{key:0}):b("v-if",!0),!n.$slots.trigger&&n.$slots.default?w(n.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)]),_:2},[n.$slots.file?{name:"default",fn:R(({file:_})=>[w(n.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0),!t(e)||t(e)&&!n.showFileList?(h(),P(ne,te({key:1,ref_key:"uploadRef",ref:c},t(u)),{default:R(()=>[n.$slots.trigger?w(n.$slots,"trigger",{key:0}):b("v-if",!0),!n.$slots.trigger&&n.$slots.default?w(n.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0),n.$slots.trigger?w(n.$slots,"default",{key:2}):b("v-if",!0),w(n.$slots,"tip"),!t(e)&&n.showFileList?(h(),P(oe,{key:3,disabled:t(r),"list-type":n.listType,files:t(k),"handle-preview":n.onPreview,onRemove:t(f)},ee({_:2},[n.$slots.file?{name:"default",fn:R(({file:_})=>[w(n.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0)]))}});var bt=M(ht,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const wt=je(bt);export{wt as E};
