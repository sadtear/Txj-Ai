import{v as Ke,l as Qe,a3 as Xe,f as Ye,a5 as Ze,r as n,aB as et,g as R,au as tt,L as at,o as u,c as d,b as i,w as r,a,h as v,m as k,t as h,F as x,i as E,d as y,k as I,aF as st,aM as lt,aC as _e,aN as ot,aD as nt,D as it,a4 as rt,at as ct,ap as me,n as Y,a9 as fe,q as ge,p as ut,e as dt,aO as vt,a6 as pt}from"./entry.35d4c246.js";import{E as _t}from"./index.25e0d62c.js";import{E as mt}from"./el-card.6e2af8d2.js";import{E as ft}from"./index.93e13010.js";import{E as gt}from"./index.d44e751f.js";import{E as ht,a as yt}from"./index.d4a9ac2e.js";import{E as bt,b as St,a as wt}from"./el-collapse.8f120924.js";import{E as kt}from"./index.6f30e63e.js";import{E as xt}from"./index.e24e47ce.js";import{b as Et,E as It,a as Ct}from"./index.85266373.js";import{E as Dt}from"./index.6bed96cc.js";import{E as zt}from"./index.1fc0ea57.js";import{_ as Lt}from"./layout.bd874b6a.js";/* empty css                *//* empty css                  *//* empty css                    *//* empty css                  */import"./el-tooltip.4ed993c7.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                   *//* empty css                    *//* empty css                        */import{e as Vt,_ as Bt}from"./errorImg.685080e1.js";import{b as Ut}from"./create.65762b44.js";import{a as Gt,b as Nt}from"./drawing.998ab448.js";import{g as Tt}from"./generateDetails.bda147ca.js";import{t as qt}from"./typeLIst.1ff2b2b6.js";import{_ as $t}from"./_plugin-vue_export-helper.c27b6911.js";import"./_baseClone.43deedb0.js";import"./_getTag.0a62c0db.js";import"./isEqual.97080887.js";import"./refs.179b14af.js";import"./strings.b7c92e5e.js";import"./debounce.7d5a41e6.js";import"./castArray.048c84c6.js";import"./index.540b2914.js";import"./dropdown.72fdcde9.js";import"./throttle.203d98ad.js";import"./position.fdd244ba.js";import"./empty_news.49a3869c.js";import"./index.f1996257.js";import"./index.89951fb8.js";import"./_commonjsHelpers.87174ba5.js";const m=N=>(ut("data-v-d4c55a28"),N=N(),dt(),N),Mt={class:"outContainer"},Ot={class:"right"},At={class:"scrollbar-demo-item"},Rt={class:"tsc"},Jt=m(()=>a("strong",{class:"cueword"},"上传原图",-1)),Pt={class:"sc"},jt=["src"],Ht={class:"mx"},Wt=m(()=>a("strong",null," 创作风格 ",-1)),Ft={class:"czfg"},Kt=["src"],Qt={class:"size"},Xt=m(()=>a("p",{class:"qi"},"奇想智能，通用万能模型",-1)),Yt={class:"styleMod"},Zt=m(()=>a("div",{class:"qb"},[a("p",null,"全部"),a("div")],-1)),ea={class:"setScrollbar"},ta={class:"itemimg",style:{display:"grid","grid-template-columns":"repeat(5, 1fr)"}},aa=["onClick"],sa=["src"],la={class:"size"},oa=m(()=>a("p",{class:"qi"},"奇想智能，通用万能模型",-1)),na={class:"demo-collapse"},ia={class:"dropdown"},ra=m(()=>a("p",{class:"draw"},"画面尺寸",-1)),ca={class:"tooltip-base-box"},ua={class:"row center"},da={class:"selector"},va=m(()=>a("div",{class:"dropdown"},[a("div",{class:"draw"},"图片质量")],-1)),pa={class:"selector"},_a={class:"dropdown",style:{position:"relative"}},ma=m(()=>a("p",{class:"draw"},"生成张数",-1)),fa={class:"tooltip-base-box"},ga={class:"row center"},ha={class:"slider-demo-block"},ya=["onClick"],ba={class:"fixedBottom"},Sa={style:{display:"flex","justify-content":"space-between"}},wa={style:{"font-size":"12px"}},ka={style:{"font-size":"12px"}},xa={style:{display:"flex","justify-content":"space-between"}},Ea={style:{"font-size":"12px"}},Ia={class:"ljsc"},Ca={class:"rightshow"},Da=m(()=>a("div",{class:"allbox"},[a("span",null,"生成记录")],-1)),za={class:"showpicture"},La={class:"showGenerateBox"},Va={class:"showGenerateBoxTop"},Ba={class:"showGenerateBoxTopRight"},Ua=m(()=>a("span",null,"|",-1)),Ga={class:Y(["showGenerateBoxBottom"])},Na=Ke({__name:"index",setup(N){const f=Qe();Xe(),Ye();const D=Ze(),J=n(!1),P=n(!1),he=n(`${et()}/api/upload/image`),z=n(""),ye=(e,t)=>{z.value=e.data.path},be=e=>(console.log(e),e.type!="image/jpeg"&&e.type!="image/png"&&e.type!="image/PSD"&&e.type!="image/webp"&&e.type!="image/SVG"?(I.error("Avatar picture must be jpeg、png、PSD、webP、SVG format!"),!1):e.size/1024/1024>2?(I.error("Avatar picture size can not exceed 2MB!"),!1):!0),T=n(!1),p=n(null),Se=n(""),j=n("MJ"),_=n(1),we=n("generate"),q=n(""),H=n(1),$=n(""),W=n(""),Z=n(!1),ke=R([{label:"普通",value:0},{label:"高清",value:1},{label:"超清",value:2},{label:"精绘",value:3}]),xe=n([1,4]),ee=n(0);R({channel:j});const te=R([]),F=n(""),L=n(""),Ee=(e,t)=>{ee.value=t,_.value=e},Ie=async()=>{const e=await Ut({channel:"MJ"});for(var t=0;t<e.length;t++)te.push(e[t]);F.value=e[0].imgUrl,L.value=e[0].name},ae=e=>{vt.confirm("是否删除此作品内所有图片","确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Ce([e])})},Ce=async e=>{let t=[];for(let o in e)t.push(e[o]);if(!t.length){pt.msgError("请选择需要删除的图片");return}try{await Nt(t).then(o=>{I({type:"success",message:"删除成功"})}),s.value=[],V()}catch(o){console.log("删除失败绘画记录",o)}};Ie();const De=n(),ze=e=>{F.value=e.imgUrl,L.value=e.name,De.value=e.command,A.value=!1},M=n({channel:j,prompt:Se,batchSize:_,action:we,sizeRatio:q,quality:H,imageBase:z}),O=n({channel:j,taskId:$}),s=n([]),V=e=>{C.value=0,Gt({pageNo:1,pageSize:5,drawType:2}).then(o=>{if(e!="no"&&(s.value=o.lists),e!="no"){if(!f.timer&&s.value.length>0){for(let c in s.value)if(s.value[c].progress!="100%"&&f.userInfo.balanceDraw>=_.value*2){p.value=!0,s.value[c].born=!0,console.log(11),s.value[c].LoseStatus=!1,O.value.channel=s.value[c].channel,O.value.taskId=s.value[c].taskId,B("no");return}}}else if(localStorage.getItem("historyGenerateDatas2")){let c=JSON.parse(localStorage.getItem("historyGenerateDatas2"));s.value.forEach(b=>{c.id==b.id&&(console.log(22),b=c,b.born=!0,b.LoseStatus=!1)})}else for(let c in s.value)s.value[c].imageUrls||(s.value[c].born=!1,s.value[c].LoseStatus=!0,console.log(33))}).catch(o=>{console.log(o)})},K=n(!1),C=n(0),B=e=>{st(O.value).then(t=>{if(C.value++,Z.value=!1,W.value=t.progress,s.value.length>=1){for(let o in s.value)t.id==s.value[o].id&&!s.value[o].LoseStatus?s.value[o].progress!="100%"&&(s.value[o]=t,K.value=!1):K.value=!0;K.value&&(t.id==s.value[0].id?s.value[0]=t:s.value.unshift(t))}else s.value.unshift(t);if(window.dispatchEvent(new CustomEvent("onProgress2",{detail:{data:W.value,value:t}})),W.value!=="100%"){if(f.timer2=setTimeout(B,8e3),s.value.length>0)for(let o in s.value)t.id==s.value[o].id&&(s.value[o].born=!0,s.value[o].LoseStatus=!1);p.value=!0,localStorage.setItem("historyGenerateDatas2",JSON.stringify(t))}else{if(s.value.length>0){for(let o in s.value)s.value[o].imageUrls&&(s.value[o].imageUrlList=s.value[o].imageUrls.split(","));for(let o in s.value)t.id==s.value[o].id&&(s.value[o].born=!1)}p.value=!1,C.value==1?V():V("no"),e=="no"&&V("no")}}).catch(t=>{for(let o in s.value)s.value[o].taskId==O.value.taskId&&(s.value[o].LoseStatus=!0,s.value[o].born=!1);localStorage.setItem("historyImgGenerateData",JSON.stringify(s.value.slice(0,5))),Z.value=!0,p.value=!1})},Le=e=>{lt({id:e}).then(t=>{Ge(t.drawWorkId)}).catch(t=>{console.log(t)})},Ve=e=>(console.log("progress",e.progress),e.progress?e.progress.split("%")[0]:0),Be=()=>{if(f.userInfo.balanceDraw<_.value*2){I({type:"success",message:"请联系管理员"});return}else Ue()},Ue=async()=>{if(C.value=0,D.query&&!D.query.id){if(!z.value)return I({message:"请上传图片",type:"warning"});if(p.value){I({message:"正在生成中...",type:"warning"});return}}M.value.useTokens=_.value*2,M.value.styleName=L.value,M.value.prompt=L.value,T.value||(T.value=!0,await _e(M.value).then(e=>{f.getUser(),p.value=!0,$.value=e.taskId,B(),T.value=!1}).catch(e=>{T.value=!1,p.value=!1}))},Ge=e=>{ot({},e).then(t=>{p.value=!0,$.value=t.taskId,B()})},Ne=async(e,t)=>{f.userInfo.balanceDraw<_.value*2&&I({type:"success",message:"请联系管理员"}),C.value=0;const o=R({channel:e.channel,prompt:e.prompt,batchSize:e.batchSize,sizeRatio:e.scale,quality:e.quality,imageBase:e.imageBase,action:"generate",styleName:e.prompt,useTokens:_.value*2});await _e(o).then(c=>{p.value=!0,$.value=c.taskId,B()}),s.value.splice(t,1),localStorage.setItem("historyImgGenerateData",JSON.stringify(s.value))},Te=(e,t)=>{var o=new Image;o.setAttribute("crossOrigin","anonymous"),o.onload=function(){var c=document.createElement("canvas");c.width=o.width,c.height=o.height;var b=c.getContext("2d");b.drawImage(o,0,0,o.width,o.height);var Q=c.toDataURL("image/png"),U=document.createElement("a"),w=new MouseEvent("click");U.download=t||"photo",U.href=Q,U.dispatchEvent(w)},o.src=e},qe=e=>{let t=new Date().getTime();Te(e,`${t}`)},$e=e=>{const t=e.imageUrls.split(",");for(var o=0;o<t.length;o++)qe(t[o])};n(!0),n(!0),n(!0),n(""),n(!1),n(!1),n(!1);const A=n(!1);n(1),n(7),n(1),n(0),n(0),n(0),n(""),n("");const se=n([]);(async()=>{await nt().then(e=>{se.value=e.filter(t=>t.name!="暂无"),q.value=e[0].ratioWidth+":"+e[0].ratioHeight})})(),n(""),n("");const le=n(["1"]);n(["1"]);const Me=e=>{console.log(e)};n(""),n(""),n(""),n(!1);const oe=(e,t)=>{if(console.log(e),J.value=e,P.value=e,t){for(let o in historyGenerateData.value)t==historyGenerateData.value[o].id&&(historyGenerateData.value[o].isContribute=!0);localStorage.setItem("historyGenerateData",JSON.stringify(historyGenerateData.value))}},ne=n(),Oe=e=>{J.value=!0,console.log(e),ne.value=e.id},ie=n(),Ae=e=>{P.value=!0,ie.value=e.id};return tt(()=>{C.value=0,V(),console.log("定时器",f.timer),D.query&&D.query.id&&Le(D.query.id),window.addEventListener("onProgress2",function(e){if(p.value=e.detail.data!="100%",e.detail.data=="100%"){for(let t in s.value)if(e.detail.value.id==s.value[t].id){s.value[t]=e.detail.value,s.value[t].born=!1,s.value[t].LoseStatus=!1,console.log("监听进来了",s.value);break}}else for(let t in s.value)if(e.detail.value.id==s.value[t].id){s.value[t]=e.detail.value,s.value[t].born=!0,s.value[t].LoseStatus=!1,console.log("监听进来了",s.value);break}})}),(e,t)=>{const o=it,c=_t,b=mt,Q=at("StarFilled"),U=ft,w=rt,re=gt,ce=yt,ue=ht,de=bt,Re=St,Je=wt,Pe=kt,ve=xt,G=Et,je=It,He=Ct,pe=Dt,We=zt,Fe=Lt;return u(),d("div",null,[i(Fe,{name:"default"},{default:r(()=>[a("div",Mt,[a("div",Ot,[i(ve,null,{default:r(()=>[a("p",At,[a("div",Rt,[Jt,a("div",Pt,[i(c,{class:"avatar-uploader",action:he.value,"show-file-list":!1,"on-success":ye,"before-upload":be},{default:r(()=>[z.value?(u(),d("img",{key:0,src:z.value+v(f).zip,class:"avatar",style:{"max-height":"178px"}},null,8,jt)):(u(),k(o,{key:1,class:"avatar-uploader-icon"},{default:r(()=>[i(v(ct))]),_:1}))]),_:1},8,["action"])])]),a("div",Ht,[Wt,a("div",Ft,[i(b,{"body-class":"selectStyle",shadow:"hover",onClick:t[0]||(t[0]=l=>A.value=!0)},{default:r(()=>[a("img",{src:F.value,alt:""},null,8,Kt),a("div",Qt,[a("p",null,h(L.value),1),Xt])]),_:1}),i(U,{modelValue:A.value,"onUpdate:modelValue":t[1]||(t[1]=l=>A.value=l),title:"创作风格",width:"60%"},{default:r(()=>[a("div",Yt,[Zt,a("div",ea,[a("ul",ta,[(u(!0),d(x,null,E(te,(l,S)=>(u(),d("li",{class:"img",key:S,onClick:g=>ze(l)},[a("img",{src:l.imgUrl,alt:"",style:{height:"112px","object-fit":"cover"}},null,8,sa),a("div",null,[a("div",null,[a("p",la,h(l.name),1),oa]),i(o,null,{default:r(()=>[i(Q)]),_:1})])],8,aa))),128))])])])]),_:1},8,["modelValue"])])]),a("div",na,[i(Je,{modelValue:le.value,"onUpdate:modelValue":t[4]||(t[4]=l=>le.value=l),onHandleChange:Me},{default:r(()=>[i(Re,{class:"title",title:"参数设定",name:"1"},{default:r(()=>[a("div",ia,[ra,a("div",null,[a("div",ca,[a("div",ua,[i(re,{class:"box-item",effect:"dark",content:"选择需要的比例与尺寸，尺寸越大耗时越久。",placement:"top-start"},{default:r(()=>[i(w,null,{default:r(()=>[i(o,null,{default:r(()=>[i(v(me))]),_:1})]),_:1})]),_:1})])])])]),a("div",da,[i(ue,{modelValue:q.value,"onUpdate:modelValue":t[2]||(t[2]=l=>q.value=l),class:"m-2",placeholder:"3:4"},{default:r(()=>[(u(!0),d(x,null,E(se.value,l=>(u(),k(ce,{key:l.ratioWidth+":"+l.ratioHeight,label:l.name+""+l.ratioWidth+":"+l.ratioHeight,value:l.ratioWidth+":"+l.ratioHeight},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i(de),va,a("div",pa,[i(ue,{modelValue:H.value,"onUpdate:modelValue":t[3]||(t[3]=l=>H.value=l),class:"m-2"},{default:r(()=>[(u(!0),d(x,null,E(ke,l=>(u(),k(ce,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i(de),a("div",_a,[ma,a("div",null,[a("div",fa,[a("div",ga,[i(re,{class:"box-item",effect:"dark",content:"生成张数越多，耗时越久。",placement:"top-start"},{default:r(()=>[i(w,null,{default:r(()=>[i(o,null,{default:r(()=>[i(v(me))]),_:1})]),_:1})]),_:1})])])])]),a("div",ha,[(u(!0),d(x,null,E(xe.value,(l,S)=>(u(),d("div",{class:"flex",key:S},[a("div",{class:Y([ee.value==S?"slider-active":"","slider-item"]),onClick:g=>Ee(l,S)},h(l)+"张",11,ya)]))),128))])]),_:1})]),_:1},8,["modelValue"])])]),a("div",ba,[a("div",Sa,[a("div",wa,"消耗"+h(_.value*2)+"条绘画次数",1),a("div",null,[i(Pe,{placement:"top-end",title:"明细",width:200,trigger:"hover"},{reference:r(()=>[a("div",Ea,[y("明细 "),i(o,{size:12},{default:r(()=>[i(v(fe))]),_:1})])]),default:r(()=>[a("div",ka,[a("div",xa,[a("span",null,"图生图*"+h(_.value),1),a("span",null,h(_.value*2)+"条绘画次数",1)])])]),_:1})])]),a("div",Ia,[i(w,{type:"primary",onClick:Be,disabled:e.loadingStatus},{default:r(()=>[y(h(e.loadingStatus?"请求中...":"立即生成"),1)]),_:1},8,["disabled"])])])]),_:1})]),a("div",Ca,[i(ve,{height:"82vh"},{default:r(()=>[Da,a("div",za,[s.value.length>0?(u(!0),d(x,{key:0},E(s.value,(l,S)=>(u(),d("div",La,[a("div",Va,[a("div",Ba,[a("span",null,h(l.createTime),1),a("span",null,"绘画渠道: "+h(l.channel?l.channel:"无"),1),Ua,l.LoseStatus?(u(),k(w,{key:0,onClick:g=>ae(l.id),style:{"margin-right":"8px"}},{default:r(()=>[y("删除")]),_:2},1032,["onClick"])):ge("",!0),i(He,{trigger:"click"},{dropdown:r(()=>[i(je,null,{default:r(()=>[i(G,{onClick:g=>$e(l)},{default:r(()=>[y("下载")]),_:2},1032,["onClick"]),i(G,{onClick:g=>Ne(l,S)},{default:r(()=>[y("重绘")]),_:2},1032,["onClick"]),i(G,{onClick:g=>ae(l.id)},{default:r(()=>[y("删除")]),_:2},1032,["onClick"]),i(G,{onClick:g=>Ae(l)},{default:r(()=>[y("投稿")]),_:2},1032,["onClick"]),i(G,{onClick:g=>Oe(l)},{default:r(()=>[y("详情")]),_:2},1032,["onClick"])]),_:2},1024)]),default:r(()=>[i(w,{type:"primary",disabled:l.born},{default:r(()=>[y(" 功能选择"),i(o,{class:"el-icon--right"},{default:r(()=>[i(v(fe))]),_:1})]),_:2},1032,["disabled"])]),_:2},1024)])]),a("div",Ga,[l.progress=="100%"?(u(!0),d(x,{key:0},E(l.imageUrlList,(g,X)=>(u(),k(pe,{style:{"border-radius":"5px",margin:"0px 5px"},src:l.imageUrlList[X]+v(f).zip,"zoom-rate":1.2,"preview-src-list":l.imageUrlList,"initial-index":X,fit:"cover","hide-on-click-modal":"true",key:X},null,8,["src","preview-src-list","initial-index"]))),128)):l.LoseStatus?(u(),k(pe,{key:1,style:{"border-radius":"5px",margin:"0px 5px"},src:v(Vt),"zoom-rate":1.2,"initial-index":S,fit:"cover","hide-on-click-modal":"true"},null,8,["src","initial-index"])):l.born==!0?(u(!0),d(x,{key:2},E(l.batchSize,g=>(u(),d("div",{ref_for:!0,ref:"boxImg",class:Y([l.scale=="1:1"?"imageSize1_1":l.scale=="2:3"?"imageSize2_3":l.scale=="3:2"?"imageSize3_2":l.scale=="3:4"?"imageSize3_4":l.scale=="4:3"?"imageSize4_3":l.scale=="9:16"?"imageSize9_16":l.scale=="16:9"?"imageSize16_9":" ","showGenerateBoxBottomLoad"])},[i(We,{type:"circle","striped-flow":"",status:l.LoseStatus,color:l.LoseStatus?"red":"",percentage:Ve(l)},null,8,["status","color","percentage"])],2))),256)):ge("",!0)])]))),256)):(u(),k(v(Bt),{key:1}))])]),_:1})])])]),_:1}),i(v(Tt),{dialogTableVisible:J.value,id:ne.value,onChangeStatus:oe},null,8,["dialogTableVisible","id"]),i(v(qt),{contributeVisible:P.value,id:ie.value,onChangeOff:oe},null,8,["contributeVisible","id"])])}}});const Ds=$t(Na,[["__scopeId","data-v-d4c55a28"]]);export{Ds as default};
