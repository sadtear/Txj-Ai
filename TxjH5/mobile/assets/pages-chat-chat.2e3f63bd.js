import{d as e,E as t,x as l,c as a,a as s,b as o,o as r,e as i,f as n,g as c,n as u,j as d,u as p,aR as A,i as g,F as m,l as v,h as x,D as f,k as y,K as I,L as B,_ as k,T as E,A as h,r as Q,w as S,t as C,y as J,U as F,s as w,an as b,am as R,aS as W,aT as L,as as V,S as U,B as K,aU as G,a5 as D,aG as H}from"./index-7044850c.js";import{_ as M}from"./page-meta.66d6713f.js";import{_ as N}from"./u-icon.593ee39b.js";import{_ as Y}from"./u-loading.3bc13172.js";import{c as O,d as T,e as X,f as q,h as z,a as P,i as j,j as Z,k as _}from"./chat.e60728da.js";import{u as $}from"./useCopy.e03ce727.js";import{u as ee}from"./useLockFn.b248adc4.js";import{_ as te}from"./text-item.vue_vue_type_script_setup_true_lang.3f8512ea.js";import{_ as le}from"./u-input.1eff233e.js";import{_ as ae}from"./u-button.5deae2bc.js";import{u as se,w as oe,_ as re}from"./index.e66e4f7b.js";import{_ as ie}from"./u-action-sheet.5bee5d05.js";import{_ as ne}from"./gpt.23e2aee4.js";import{u as ce,_ as ue}from"./useSessionList.4145dc65.js";import"./_commonjsHelpers.5f26be78.js";import"./u-popup.449ebc77.js";const de=k(e({__name:"chat-record-item",props:{recordId:null,type:null,content:{default:""},showCopyBtn:{type:Boolean,default:!0},showCollectBtn:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},isCollect:null,avatar:null},emits:["update","close","click-poster"],setup(e,{emit:k}){const E=e,h=t(),Q=l(),{copy:S}=$(),{lockFn:C}=ee((async e=>{E.isCollect?(await O({id:e}),uni.$u.toast("取消成功")):(await T({id:e}),uni.$u.toast("收藏成功")),k("update")})),J=a((()=>Q.getChatConfig.isMarkdown&&"left"==E.type));return(t,l)=>{const a=s(o("u-icon"),N),E=y,Q=I,F=s(o("u-loading"),Y),w=B;return r(),i(E,{class:"chat-record-item"},{default:n((()=>[c(E,{class:u(`chat-record-item__${e.type}`)},{default:n((()=>[c(E,null,{default:n((()=>["left"==e.type?(r(),i(a,{key:0,class:"rounded-full overflow-hidden",name:e.avatar,size:80},null,8,["name"])):d("",!0)])),_:1}),"right"==e.type?(r(),i(Q,{key:0,class:"flex rounded-[50%] overflow-hidden w-[80rpx] h-[80rpx]",src:p(h).userInfo.avatar},null,8,["src"])):d("",!0),c(E,{class:u(["min-w-0 flex flex-col",{"justify-end":"right"==e.type}])},{default:n((()=>[c(E,{class:u(`chat-record-item__${e.type}-content`)},{default:n((()=>[c(E,null,{default:n((()=>[p(A)(e.content)?(r(!0),g(m,{key:0},v(e.content,((e,t)=>(r(),i(E,{key:t,class:u(["mb-[20rpx]",{"pt-[20rpx] border-t border-solid border-light border-0":t>0}])},{default:n((()=>[c(te,{"is-markdown":p(J),content:e},null,8,["is-markdown","content"])])),_:2},1032,["class"])))),128)):(r(),i(te,{key:1,"is-markdown":p(J),content:e.content},null,8,["is-markdown","content"])),e.loading?(r(),i(E,{key:2,class:"flex items-center text-muted text-sm mt-[16rpx]"},{default:n((()=>[c(F,{mode:"flower"}),c(E,{class:"ml-[10rpx]"},{default:n((()=>[x("加载中，请稍等")])),_:1})])),_:1})):d("",!0),e.showCopyBtn&&e.showCollectBtn&&!e.loading&&p(h).isLogin&&"left"===e.type?(r(),i(E,{key:3,class:"flex justify-between"},{default:n((()=>[c(E,{class:"mt-[16rpx] flex"},{default:n((()=>[e.showCopyBtn?(r(),i(E,{key:0,class:"text-[#4073fa] text-sm",onClick:l[0]||(l[0]=t=>p(S)(e.content))},{default:n((()=>[x(" 复制 ")])),_:1})):d("",!0),e.showCollectBtn?(r(),i(E,{key:1,class:u(["text-sm ml-[30rpx]",{"text-primary":e.isCollect,"text-muted":!e.isCollect}]),onClick:l[1]||(l[1]=t=>p(C)(e.recordId))},{default:n((()=>[x(" 收藏 ")])),_:1},8,["class"])):d("",!0)])),_:1}),p(h).isLogin?(r(),i(E,{key:0,class:"flex items-center mt-[16rpx] ml-[20rpx]",onClick:l[2]||(l[2]=t=>k("click-poster",e.recordId))},{default:n((()=>[c(a,{name:"photo",color:"#999"}),c(w,{class:"text-muted text-sm ml-[10rpx]"},{default:n((()=>[x("生成海报")])),_:1})])),_:1})):d("",!0)])),_:1})):d("",!0)])),_:1})])),_:1},8,["class"]),"right"==e.type?(r(),i(E,{key:0,class:"flex items-center justify-end pr-[20rpx] pt-[10rpx]",onClick:l[3]||(l[3]=t=>p(S)(e.content))},{default:n((()=>[c(Q,{class:"w-[26rpx] h-[26rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAVRJREFUaEPtmcEOgjAMhjueQxN9Mg8e1TvEg3gwcFePHnwyTeQ5NkPERA2D39VlI5Zz1/Xrv1LoFA38UQOPnwRgV+zzRCUzIpp4UPOqjT6vs1Vu881SoAl+4yHwN5fa6K0NggVQlIcbkRr5BiAyVZYux237MAGO5uk0SxcsX23BFWW/f9amyAYcdRD//w3AyS6y1rsCSBAcGwEI3aRYCsTQpFgAMTQpJkB/E/FdoAIQ+jNBFBAFOqocOR6IjfVjDlksb6EmA7Z/CSSJooDrMUKyi9iIAqIAEUkRu440XI9PvQ4pUMRGithVBSS7iI0o8GsFXrP+4vuapYvpV7NRRD7X4LuKuA3AaTodB4CptDEnp/uBUADfqhp1ESMwAoBkyWenFwViVuDi6er0k9napJDkWI9QDNNpFkC9+AGh5n6uUvubFBsAcRDahnVLGTr4ev/BA9wBde+sQG9B6poAAAAASUVORK5CYII="}),c(w,{class:"text-xs text-muted ml-[8rpx]"},{default:n((()=>[x("复制")])),_:1})])),_:1})):d("",!0),f(t.$slots,"footer",{},void 0,!0)])),_:3},8,["class"])])),_:3},8,["class"])])),_:3})}}}),[["__scopeId","data-v-9f1f8cb0"]]),pe=k(e({options:{virtualHost:!0},__name:"chat-scroll-view",props:{modelValue:null,type:null,otherId:null,categoryId:null,bottom:{default:0},tips:{default:""},name:{default:""},placeholder:{default:"请输入内容"},currentModel:null,safeAreaInsetBottom:{type:Boolean,default:!0},showAdd:{type:Boolean,default:!1},modeLists:{default:[]}},emits:["update:modelValue","reader","end"],setup(e,{expose:l,emit:A}){const g=e,m=E(),v=t(),k=h(),K=h(),G=Q(!1),D=Q({});Q("gpt3.5");const{sessionActive:H,sessionAdd:M,currentSession:Y,sessionEdit:O}=ce(),T=a({get:()=>g.modelValue,set(e){A("update:modelValue",e)}}),P=e=>{console.log("val",e),console.log(g.modeLists),D.value=g.modeLists[e]},j=Q(""),Z=Q(""),_=Q(""),$=()=>{if(!v.isLogin)return ye()},{lockFn:te}=ee((async()=>{if(ge.value)return;const e=T.value[T.value.length-1],t=T.value.find((({id:t})=>t===e.id));t&&(await X({id:e.id}),T.value.splice(T.value.length-2,2),xe(t.content))}));ee((async()=>{if(!v.isLogin)return ye();(await b({title:"温馨提示",content:"确定清空对话？"})).cancel||(ve(),await q({type:g.type,otherId:g.otherId,categoryId:g.categoryId}),A("end"))}));let ue=0;const de=e=>{ue=e.detail.scrollTop},pe=async()=>{_.value="observer-line",await R(),_.value=""},Ae=Q(),ge=Q(!1);let me=null;const ve=()=>{null==me||me.abort(),setTimeout((()=>{j.value=""}))},{lockFn:xe,isLock:fe}=ee((async e=>{if(1!=D.value.member_free&&v.userInfo.balance<D.value.balance)return void W({title:"请联系管理员",icon:"none"});if(!v.isLogin)return ye();if(ge.value)return;const t=e||j.value;if(!t)return uni.$u.toast(g.placeholder);1==g.type&&(0===H.value&&await M(),"新的会话"===Y.value&&await O(H.value,t)),T.value.push({type:1,content:t}),T.value.push({type:2,loading:!0,content:[],id:""}),pe(),Z.value=j.value,j.value="";try{ge.value=!0,await z({question:t,type:g.type,otherId:g.otherId,categoryId:g.categoryId,modelKey:D.value.text},{onstart(e){console.log("发起对话"),me=e,A("reader",e)},onmessage(e){e.trim().split("data:").forEach((async e=>{var t;if(""!==e)try{const l=JSON.parse(e);console.log(l);const{id:a,event:s,data:o,error:r,index:i}=l;r&&101==(null==r?void 0:r.errCode)?(j.value=Z.value,null==(t=K.value)||t.open()):r&&(uni.$u.toast(r.errMsg),ge.value=!1,T.value.splice(T.value.length-2,2));let n=T.value.findIndex((e=>e.id===a));if(-1===n&&(n=T.value.length-1,T.value[n].id=a),o&&(T.value[n].content[i]||(T.value[n].content[i]=""),T.value[n].content[i]+=o),"finish"===s)return void(T.value[n].loading=!1)}catch(l){console.log("转换失败=>",l)}}))},onclose(){console.log("对话结束"),ge.value=!1,setTimeout((()=>{A("end")}),400)}})}catch(l){console.log("发送消息失败=>",l),l.errMsg!==L.ABORT&&T.value.splice(T.value.length-2,2),j.value=Z.value,ge.value=!1}})),ye=()=>{m.reLaunch({path:"/pages/login/login"})},{height:Ie}=se(k);console.log("height=----",Ie),oe(Ie,(()=>{ge.value&&pe()}),{throttle:500}),S(H,(async e=>{e&&ve()})),S((()=>g.modeLists),((e,t)=>{console.log("----111111",e),e&&(D.value=g.modeLists[0],console.log("----111111",g.modeLists[0]))}));const Be=()=>{location.reload()},ke=()=>{V()};return l({scrollToBottom:pe,setUserInput:(e="")=>{j.value=e},sendLock:xe,scrollTo:async e=>{Ae.value=ue,await R(),Ae.value=e}}),(t,l)=>{const a=s(o("u-icon"),N),A=B,g=y,m=U,v=I,E=s(o("u-input"),le),h=s(o("u-button"),ae),Q=s(o("guided-popup"),re),S=s(o("u-action-sheet"),ie);return r(),i(g,{class:"chat-scroll-view h-full flex flex-col bg-[#1c1c1e]"},{default:n((()=>[c(g,{class:"title flex flex-center"},{default:n((()=>[c(a,{onClick:ke,class:"titleIcon",name:"arrow-left",color:"#fff",size:"40"}),c(A,{class:"text flex-1"},{default:n((()=>[x(C(e.name),1)])),_:1}),c(g,{class:"titleIcon"})])),_:1}),c(g,{class:"flex-1 min-h-0 bg-[#1c1c1e]"},{default:n((()=>[c(m,{class:"scroll-view-container h-full","scroll-y":"true","scroll-into-view":_.value,"scroll-top":Ae.value,onScroll:de},{default:n((()=>[c(g,{class:"scroll-view-content pb-[20rpx] bg-[#1c1c1e]",ref_key:"contentRef",ref:k},{default:n((()=>[f(t.$slots,"default",{},void 0,!0)])),_:3},512),p(T).length?(r(),i(g,{key:0,class:"ml-[120rpx] flex"},{default:n((()=>[c(g,{class:"px-[20rpx] py-[10rpx] text-xs flex items-center bg-page rounded-full mr-[20rpx]",onClick:l[0]||(l[0]=e=>p(xe)("继续"))},{default:n((()=>[c(a,{name:"play-circle",class:"mr-[8rpx]",size:"36"}),x(" 继续 ")])),_:1}),c(g,{class:"px-[20rpx] py-[10rpx] text-xs flex items-center bg-page rounded-full",onClick:p(te)},{default:n((()=>[c(a,{name:"edit-pen",class:"mr-[8rpx]",size:"32"}),x(" 重写 ")])),_:1},8,["onClick"])])),_:1})):d("",!0),c(g,{id:"observer-line",class:"h-[1px]"})])),_:3},8,["scroll-into-view","scroll-top"])])),_:3}),c(g,{class:"send-area",style:J([{"background-color":"#333"},{bottom:p(F)(e.bottom)}])},{default:n((()=>[c(g,{class:"msg-box"},{default:n((()=>[c(g,{class:"msg-box-item bg-[#333] flex flex-center",onClick:Be},{default:n((()=>[c(v,{style:{width:"30rpx",height:"26rpx"},src:"data:image/png;base64,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"}),c(A,{style:{}},{default:n((()=>[x("开启新话题")])),_:1})])),_:1}),"{}"!=JSON.stringify(D.value)?(r(),i(g,{key:0,class:"msg-box-item flex bg-[#333] flex-center",onClick:l[1]||(l[1]=e=>G.value=!0)},{default:n((()=>[c(v,{style:{width:"30rpx",height:"30rpx"},src:ne}),c(A,null,{default:n((()=>[x(C(D.value.text),1)])),_:1})])),_:1})):d("",!0)])),_:1}),c(g,{class:u(["send-area__content flex flex-center",[e.safeAreaInsetBottom?"safe-area-inset-bottom":""]])},{default:n((()=>[c(E,{class:"flex-1",type:"text",modelValue:j.value,"onUpdate:modelValue":l[2]||(l[2]=e=>j.value=e),placeholder:e.placeholder,maxlength:"-1","cursor-spacing":120,"auto-height":!1,"confirm-type":"send",fixed:!0,"custom-style":{height:"50rpx",fontSize:"28rpx",lineHeight:"40rpx",boxSizing:"border-box",background:"#1c1c1e",borderRadius:"20rpx",marginRight:"15rpx",marginBottom:"10rpx",color:"#fff",paddingLeft:"15rpx"},onClick:$,onFocus:pe,onBlur:pe},null,8,["modelValue","placeholder"]),c(h,{style:{color:"#fff",borderRadius:"33rpx"},type:"primary","custom-style":{width:"66rpx",height:"66rpx",borderRadius:"50%",marginBottom:"10rpx"},size:"mini",disabled:ge.value,onClick:l[3]||(l[3]=w((e=>p(xe)()),["stop"]))},{default:n((()=>[c(v,{style:{width:"60rpx",height:"34rpx","z-index":"99","margin-top":"1rpx","margin-right":"1rpx"},src:"data:image/png;base64,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"})])),_:1},8,["disabled"])])),_:1},8,["class"])])),_:1},8,["style"]),c(Q,{ref_key:"guidedPopupRef",ref:K},null,512),c(S,{list:e.modeLists,modelValue:G.value,"onUpdate:modelValue":l[4]||(l[4]=e=>G.value=e),onClick:P},null,8,["list","modelValue"])])),_:3})}}}),[["__scopeId","data-v-6f96ba6a"]]),Ae=k(e({__name:"chat",setup(e){E();const t=D(),l=K({id:0,type:1,token:""}),a=Q(""),u=Q([]),p=h(),A=async()=>{const e=await P({otherId:l.id,type:l.type});u.value=e,console.log(11111111111,u.value),setTimeout((()=>{var e;null==(e=p.value)||e.scrollToBottom()}),200)},x=Q({}),f=Q([]),I=h(),B=async e=>{const t=u.value.filter((t=>t.id==e));2==t.length?I.value.initPosterData({title:t[0].content,content:t[1].content}):uni.$u.toast("上下文数据不对～")};return G((()=>{l.id=Number(t.query.id),l.type=Number(t.query.type),(async()=>{switch(l.type){case 2:x.value=await Z({id:l.id});break;case 3:x.value=await j({id:l.id})}H({title:x.value.name})})(),A(),(async()=>{await _().then((e=>{f.value=e,f.value.forEach((e=>{e.text=e.name,e.default&&(a.value=e.name,console.log("===============",a.value))})),console.log("res----",f.value)}))})()})),(e,t)=>{const k=s(o("page-meta"),M),E=s(o("chat-record-item"),de),h=y,Q=s(o("chat-scroll-view"),pe),S=s(o("dialog-poster"),ue);return r(),g(m,null,[c(k,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),c(h,{class:"safe-area-inset-bottom h-screen bg-[#333]"},{default:n((()=>[c(Q,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),ref_key:"chatRef",ref:p,tips:x.value.tips,name:x.value.name,type:l.type,otherId:l.id,currentModel:a.value,modeLists:f.value,onEnd:A},{default:n((()=>[c(h,{class:"bg-white scroll-view-content"},{default:n((()=>[c(h,{class:"chat-record pt-[20rpx] bg-[#1c1c1e]"},{default:n((()=>[!u.value.length&&x.value.tips?(r(),i(E,{key:0,type:"left",avatar:x.value.image,content:`${x.value.tips}`,"show-collect-btn":!1},null,8,["avatar","content"])):d("",!0),(r(!0),g(m,null,v(u.value,((e,t)=>(r(),i(E,{key:t,"record-id":e.id,type:1==e.type?"right":"left",content:e.content,loading:e.loading,avatar:x.value.image,"is-collect":e.isCollect,onUpdate:A,onClickPoster:B},null,8,["record-id","type","content","loading","avatar","is-collect"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","tips","name","type","otherId","currentModel","modeLists"]),c(S,{ref_key:"posterRef",ref:I},null,512)])),_:1})],64)}}}),[["__scopeId","data-v-088cc880"]]);export{Ae as default};
