import{d as e,x as a,E as t,c as s,r as l,at as r,C as u,a2 as o,a3 as c,a4 as n,X as i,q as f,au as d,Z as g,o as m,i as p,g as _,f as x,u as y,h as w,t as b,e as h,j as v,F as j,av as k,an as C,a as I,b as E,k as V,aw as W,ax as A,ay as F,az as B,aA as U,_ as X}from"./index-7044850c.js";import{_ as D}from"./page-meta.66d6713f.js";import{_ as N}from"./u-avatar.3fcdc4b9.js";import{_ as P}from"./u-icon.593ee39b.js";import{_ as R}from"./u-button.5deae2bc.js";import{_ as T}from"./u-action-sheet.5bee5d05.js";import{u as $}from"./useLockFn.b248adc4.js";import"./u-popup.449ebc77.js";var z=(e=>(e.PRIVACY="privacy",e.SERVICE="service",e))(z||{});const L=X(e({__name:"user_set",setup(e){const X=a(),L=t(),S=s((()=>L.userInfo)),Y=l([{text:"修改密码"},{text:"忘记密码"}]),q=l(!0);q.value=r();const M=l(!1),J=e=>{switch(e){case 0:k.navigateTo("/pages/change_password/change_password");break;case 1:k.navigateTo("/pages/forget_pwd/forget_pwd")}},K=()=>{if(!S.value.hasPwd)return k.navigateTo("/pages/change_password/change_password?type=set");M.value=!0},O=()=>{k.navigateTo("/packages/pages/cancelaccount/cancelaccount")},Z=()=>{C({content:"是否退出登录？",confirmColor:"#4173FF",success:({cancel:e})=>{e||(L.logout(),k.reLaunch("/pages/login/login"))}})},{lockFn:G}=$((async()=>{if(!S.value.isBindWechat){i({title:"请稍后..."});try{if(A()==F.MP_WEIXIN){const{code:e}=await B({provider:"weixin"});await U({code:e})}else A()==F.OA_WEIXIN&&c.getUrl(n.BIND_WX);await L.getUser(),g()}catch(e){uni.$u.toast(e)}finally{g()}}}));return u((()=>{L.getUser()})),o((async()=>{const{code:e,scene:a}=c.getAuthData();if(e.length&&a===n.BIND_WX){i({title:"请稍后..."}),f.set("code",e);try{await d({code:e}),await L.getUser(),g()}catch(t){g()}finally{c.setAuthData()}}})),(e,a)=>{const t=I(E("page-meta"),D),s=I(E("u-avatar"),N),l=V,r=I(E("u-icon"),P),u=W,o=I(E("u-button"),R),c=I(E("u-action-sheet"),T);return m(),p(j,null,[_(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),_(l,{class:"user-set"},{default:x((()=>{var e;return[_(u,{url:"/pages/user_data/user_data"},{default:x((()=>[_(l,{class:"item flex bg-gray mt-[20rpx]"},{default:x((()=>[_(s,{src:y(S).avatar,shape:"square",size:100},null,8,["src"]),_(l,{class:"ml-[20rpx] flex flex-1 justify-between items-center"},{default:x((()=>[_(l,null,{default:x((()=>[_(l,{class:"mb-[15rpx] text-xl font-medium"},{default:x((()=>[w(b(y(S).nickname),1)])),_:1}),_(l,{class:"text-xs"},{default:x((()=>[w("账号："+b(y(S).username),1)])),_:1})])),_:1}),_(r,{name:"arrow-right",color:"#666"})])),_:1})])),_:1})])),_:1}),_(l,{class:"item bg-gray mt-[20rpx] btn-border flex flex-1 justify-between",onClick:K},{default:x((()=>[_(l,{class:""},{default:x((()=>[w("登录密码")])),_:1}),_(r,{name:"arrow-right",color:"#666"})])),_:1}),q.value?(m(),h(l,{key:0,class:"item bg-gray flex flex-1 justify-between",onClick:y(G)},{default:x((()=>[_(l,{class:""},{default:x((()=>[w("绑定微信")])),_:1}),_(l,{class:"flex justify-between"},{default:x((()=>[_(l,{class:"text-muted mr-[20rpx]"},{default:x((()=>[w(b(y(S).isBindWechat?"已绑定":"未绑定"),1)])),_:1}),0==y(S).isBindWechat?(m(),h(r,{key:0,name:"arrow-right",color:"#666"})):v("",!0)])),_:1})])),_:1},8,["onClick"])):v("",!0),_(u,{url:`/pages/agreement/agreement?type=${y(z).PRIVACY}`},{default:x((()=>[_(l,{class:"item bg-gray mt-[20rpx] btn-border flex flex-1 justify-between"},{default:x((()=>[_(l,{class:""},{default:x((()=>[w("隐私政策")])),_:1}),_(r,{name:"arrow-right",color:"#666"})])),_:1})])),_:1},8,["url"]),_(u,{url:`/pages/agreement/agreement?type=${y(z).SERVICE}`},{default:x((()=>[_(l,{class:"item bg-gray btn-border flex flex-1 justify-between"},{default:x((()=>[_(l,{class:""},{default:x((()=>[w("服务协议")])),_:1}),_(r,{name:"arrow-right",color:"#666"})])),_:1})])),_:1},8,["url"]),_(u,{url:"/pages/as_us/as_us"},{default:x((()=>[_(l,{class:"item bg-gray flex flex-1 justify-between"},{default:x((()=>[_(l,{class:""},{default:x((()=>[w("关于我们")])),_:1}),_(l,{class:"flex justify-between"},{default:x((()=>[_(l,{class:"text-muted mr-[20rpx]"},{default:x((()=>[w(b(y(X).config.version),1)])),_:1}),_(r,{name:"arrow-right",color:"#666"})])),_:1})])),_:1})])),_:1}),1==(null==(e=y(S))?void 0:e.isCancelled)?(m(),h(l,{key:1,class:"text-nr flex justify-between mt-[10rpx] px-[30rpx] bg-gray h-[100rpx] items-center",onClick:O},{default:x((()=>[_(l,{class:"label"},{default:x((()=>[w("注销账号")])),_:1}),_(r,{name:"arrow-right",size:"22",color:"#666"})])),_:1})):v("",!0),_(l,{class:"mt-[60rpx] mx-[26rpx]"},{default:x((()=>[_(o,{type:"primary",shape:"circle",onClick:Z},{default:x((()=>[w(" 退出登录 ")])),_:1})])),_:1}),_(c,{list:Y.value,modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=e=>M.value=e),onClick:J,"safe-area-inset-bottom":!0},null,8,["list","modelValue"])]})),_:1})],64)}}}),[["__scopeId","data-v-fce59e56"]]);export{L as default};
