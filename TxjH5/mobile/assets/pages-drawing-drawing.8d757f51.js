import{r as e,_ as t,w as a,o as l,e as r,f as s,g as o,n,y as i,h as c,t as u,j as m,D as A,ai as p,L as d,k as g,d as f,aj as x,i as h,F as w,l as C,a as y,b as _,K as v,S as B,z as Q,E as b,x as k,A as D,B as E,c as R,u as F,s as I,T as U,ak as V,X as K,Y as S,Z as Y,a0 as j,al as G,am as N,an as z,ao as H,V as T,a2 as P,ap as L,aq as Z}from"./index-7044850c.js";import{_ as O}from"./page-meta.66d6713f.js";import{_ as M}from"./u-empty.bbf2d5af.js";import{_ as J}from"./tabbar.vue_vue_type_script_setup_true_lang.ba1d1694.js";import{_ as W}from"./u-tabs.d281666d.js";import{k as X,a as q,d as $,b as ee,c as te,e as ae,f as le,g as re,h as se}from"./drawing.a9e06b49.js";import{_ as oe}from"./u-loading.3bc13172.js";import{_ as ne}from"./u-icon.593ee39b.js";import{_ as ie}from"./u-button.5deae2bc.js";import{u as ce}from"./useLockFn.b248adc4.js";import{_ as ue}from"./u-popup.449ebc77.js";import{_ as me}from"./u-input.1eff233e.js";import{_ as Ae}from"./u-picker.28f70a2f.js";import{_ as pe}from"./u-image.a4ee0c05.js";import{s as de}from"./file.f1b16d86.js";import{u as ge}from"./useCopy.e03ce727.js";import"./u-badge.900e45cf.js";/* empty css                                                               */const fe=t({__name:"l-textarea",props:{placeholder:"",maxlength:"",showWordLimit:!1,customClass:{},error:"",rows:"",modelValue:""},emits:["update:modelValue"],setup(t,{emit:f}){var x;const h=t,w=e(h.modelValue),C=e((null==(x=h.modelValue)?void 0:x.length)||0),y=e(!1),_=e=>{const t=e||window.event,a=t.detail||t.taget;f("update:modelValue",a.value)};return a((()=>h.modelValue),(e=>{w.value=e,C.value=e.length})),(e,a)=>{const f=p,x=d,h=g;return l(),r(h,{class:n(["l-textarea",{error:t.error}]),"data-error":t.error},{default:s((()=>[o(f,{class:n(["l-textarea__inner",{"!border-primary":y.value}]),"placeholder-class":"l-textarea__placeholder",placeholder:t.placeholder,rows:t.rows,modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),maxlength:t.maxlength,style:i(t.customClass),onInput:_,onFocus:a[1]||(a[1]=e=>y.value=!0),onBlur:a[2]||(a[2]=e=>y.value=!1)},null,8,["placeholder","rows","modelValue","maxlength","class","style"]),t.showWordLimit?(l(),r(h,{key:0,class:"l-textarea-length-maxlength"},{default:s((()=>[o(x,null,{default:s((()=>[c(u(C.value),1)])),_:1}),c(" / "),o(x,null,{default:s((()=>[c(u(t.maxlength),1)])),_:1})])),_:1})):m("",!0),A(e.$slots,"length-suffix",{},void 0,!0)])),_:3},8,["data-error","class"])}}},[["__scopeId","data-v-1ea3575c"]]),xe="/mobile/assets/empty-fde1f8b1.png",he=t(f({__name:"keyword-suggestion",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(t,{expose:a,emit:i}){const A=t,p=e(!1),d=e(0),f=e([]),b=e({prompt:[],cate_prompt:[]}),k=e([]);x((()=>{""==A.modelValue&&(k.value=[])}));const D=e=>{const t=k.value.findIndex((t=>t==e));t>=0?k.value.splice(t,1):k.value.push(e)},E=e=>{d.value=e,F()},R=async()=>{try{f.value=await X(),await F()}catch(e){console.log("获取关键词分类错误",e)}},F=async()=>{try{b.value=await q({id:f.value[d.value].id})}catch(e){console.log("获取关键词错误",e)}};return a({open:()=>{p.value=!0,R()}}),(e,t)=>{const a=g,x=y(_("u-tabs"),W),R=v,F=B,I=Q,U=y(_("u-popup"),ue);return l(),r(U,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),mode:"center",closeable:!0,"border-radius":"20"},{default:s((()=>[o(a,{class:"w-[640rpx] h-[980rpx]"},{default:s((()=>[o(a,{class:"p-[30rpx] text-lg text-main text-center"},{default:s((()=>[c("关键词推荐")])),_:1}),f.value.length?(l(),r(x,{key:0,list:f.value,"is-scroll":!0,"active-color":e.$theme.primaryColor,height:"60rpx","font-size":"28rpx",current:d.value,onChange:E},null,8,["list","active-color","current"])):m("",!0),o(F,{class:"h-[700rpx]","scroll-y":!0},{default:s((()=>[b.value.prompt.length||b.value.cate_prompt.length?(l(),h(w,{key:0},[(l(!0),h(w,null,C(b.value.cate_prompt,((e,t)=>(l(),r(a,{key:t,class:"keyword-container"},{default:s((()=>[o(a,{class:"keyword-title text-base text-[#666]"},{default:s((()=>[c(u(e.name)+"("+u(null==e?void 0:e.prompt.length)+") ",1)])),_:2},1024),(l(!0),h(w,null,C(e.prompt,(e=>(l(),r(a,{key:e.text,class:n(["keyword-item",{"keyword-item-active":k.value.includes(e.promptEn)}]),onClick:t=>D(e.promptEn)},{default:s((()=>[c(u(e.promptEn)+" ｜ "+u(e.prompt),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)))),128)),b.value.prompt.length?(l(),r(a,{key:0,class:"keyword-container"},{default:s((()=>[b.value.cate_prompt.length?(l(),r(a,{key:0,class:"keyword-title text-base text-[#666]"},{default:s((()=>[c(" 其它("+u(b.value.prompt.length)+") ",1)])),_:1})):m("",!0),(l(!0),h(w,null,C(b.value.prompt,(e=>(l(),r(a,{key:e.text,class:n(["keyword-item",{"keyword-item-active":k.value.includes(e.promptEn)}]),onClick:t=>D(e.promptEn)},{default:s((()=>[c(u(e.promptEn)+" ｜ "+u(e.prompt),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})):m("",!0)],64)):(l(),r(a,{key:1,class:"h-full flex flex-col justify-center items-center"},{default:s((()=>[o(R,{class:"w-[300rpx] h-[300rpx]",src:xe}),o(a,{class:"text-muted text-center"},{default:s((()=>[c("暂无关键词推荐")])),_:1})])),_:1}))])),_:1}),o(a,{class:"flex mt-[20rpx] px-[30rpx]"},{default:s((()=>[o(I,{class:"footer_btn full_btn",onClick:t[0]||(t[0]=e=>(()=>{p.value=!1;const e=A.modelValue+k.value.join(",")+",";i("update:modelValue",e),k.value=[]})())},{default:s((()=>[c(" 添加到文本描述 ")])),_:1}),o(I,{class:"footer_btn plain_btn ml-[20rpx]",onClick:t[1]||(t[1]=e=>(p.value=!1,i("update:modelValue",k.value.join(",")+","),void(k.value=[])))},{default:s((()=>[c(" 替换当前文本 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-08b7b293"]]),we=t(f({__name:"index",props:{formData:{default:{prompt:"",action:"",image_base:"",image_id:"",other:"",scale:""}}},emits:["drawing","update:modelValue"],setup(t,{emit:i}){const p=t;U(),b();const f=k(),x=D(),Q=e([]),G=E({current:0,lists:[{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAOFJREFUeF7t3LENgzAARcF4A+8/pTcgdYiCFT2lCUcPxeP86RhzzuPh+lhgCHStQ6DN6RHo20BrrXHnSTpPzpsggV4/WgKdjgtBm/0QSKD2iSGIIIJaAYJaPxtEEEGtAEGtnw0iiKBWgKDWzwYRRFArQFDrZ4MIIqgVIKj1s0EEEdQKENT62SCCCGoFCGr9bBBBBLUCBLV+NogggloBglo/G0QQQa0AQa2fDSKIoFaAoNbPBhFEUCtAUOtngwgiqBUgqPWzQQQR1AoQ1PrZIIJ+LKg9/v/u9geqzTsVSKB27J+TPVWQBC9q5AAAAABJRU5ErkJggg==",name:"头像图",widthRatio:1,heightRatio:1},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAQdJREFUeF7t3EFuwjAARUFyg9z/lLkBCJaRUIyejUCarlsDL+OvdtPtNulr3/f7pKOmHHMcxzbjoCmHPN+IQBePQyCB2o09C5q1AaPvatXrL9sggU6PdtUTJGi0wIcbOEuwK3YRXiCB2h0miCCCXgVW/ZrhirlirpgrNmLABvlTY8TJ++8hiCCCWgGCWj8bRBBBrQBBrZ8NIoigVoCg1s8GEURQK0BQ62eDCCKoFSCo9bNBBBHUChDU+tkggghqBQhq/WwQQQS1AgS1fjaIIIJaAYJaPxtEEEGtAEGtnw0iiKBWgKDWzwYRRFArQFDr93cb1D5u/+mf/+cm/SO2EwS66CfQlwI9AAMdIGdcS1eyAAAAAElFTkSuQmCC",name:"手机壁纸",widthRatio:1,heightRatio:2},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAQ9JREFUeF7t28sNgzAQBuHQAf1X6Q4S5QZE8mr1++BIH1cegtHsgA8cr2I7z/NdHfPP+8cYx+z+pzu/JwLEIAbNHFg+YtUFd+/RMxnV87QbVF0QoKL6AAF0d6A7swxiEIOuBLzFVi81vOYflRXp5lqMQQy6ERBpkc4+WxjEIAa1ln/dzxYjZsSMmBFrEVi8MtAgDdKg1gR6zWtQS5ifgxnEIAZlBBiU8dMgBjEoI8CgjJ8GMYhBGQEGZfw0iEEMyggwKOOnQQxiUEaAQRk/DWIQgzICDMr4aRCDGJQRYFDGT4MYxKCMAIMyfhrEIAZlBBiU8dMgBm1uUHZ7+51d/cXd/ldjv0fM7giggh9AIaAP+HAgZ5ZlFy4AAAAASUVORK5CYII=",name:"文案图",widthRatio:3,heightRatio:4},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAPBJREFUeF7t28ENglAURUHogP6rpAPdQ8IjOWFBGNcKyXH+1Q3r4nVZYNXnuoBAgxCBBGojQhBBBLUCk6Bt236P3uHlF18FGv4HCSRQOuSnI7bv+6d/+o8nSqCDL4GGAyeQQGmTF4IIIqgVIKj1s0EEEdQKENT62SCCCGoFCGr9bBBBBLUCBLV+NogggloBglo/G0QQQa0AQa2fDSKIoFaAoNbPBhFEUCtAUOtngwgiqBUgqPWzQQQR1AoQ1PrZIIIIagWqoEfv/sKLe2Z1+NIEEqid608/n3onnUDTEbtT8cvvIYig5p8ggghqBYZP/wEv5wKgWzTnpQAAAABJRU5ErkJggg==",name:"社交媒体",widthRatio:4,heightRatio:3},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAP1JREFUeF7t3EEOgkAQAEH5Af9/JT/QeIQLmTTZaFKeF12b2sGT22v42vf9Pbzkp5Yfx7FNNjRa/H1jgW7yCiTQqUA+YtMzPTn/T6y9ip/uV6CbuyCQQOefJY7YRYQZNHzqEkTQ7OHviDliMzHX1QQRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYRRFArQFDrZwYR9OeC2vbXX738rynWf8X2iQLd9BPo4UAfyX8gZ6mQMfoAAAAASUVORK5CYII=",name:"宣传海报",widthRatio:9,heightRatio:16},{icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAABHNCSVQICAgIfAhkiAAAAOFJREFUeF7t3LENgzAARcF4A+8/pTcgdYiCFT2lCUcPxeP86RhzzuPh+lhgCHStQ6DN6RHo20BrrXHnSTpPzpsggV4/WgKdjgtBm/0QSKD2iSGIIIJaAYJaPxtEEEGtAEGtnw0iiKBWgKDWzwYRRFArQFDrZ4MIIqgVIKj1s0EEEdQKENT62SCCCGoFCGr9bBBBBLUCBLV+NogggloBglo/G0QQQa0AQa2fDSKIoFaAoNbPBhFEUCtAUOtngwgiqBUgqPWzQQQR1AoQ1PrZIIJ+LKg9/v/u9geqzTsVSKB27J+TPVWQBC9q5AAAAABJRU5ErkJggg==",name:"自定义",widthRatio:"",heightRatio:""}]}),N=R((()=>{const e=G.lists[G.current];if(e){const{widthRatio:t,heightRatio:a}=e;if(t&&a)return`${t}:${a}`}return""}));a((()=>G),(e=>{e.current>=0&&(p.formData.scale=N.value)}),{immediate:!0,deep:!0});const{isLock:z,lockFn:H}=ce((async()=>{try{if(""==p.formData.prompt.trim())return void uni.$u.toast("请输入描述词");const{promptEn:e}=await ee({prompt:p.formData.prompt});p.formData.prompt=e}catch(e){console.log("翻译失败=>",e)}})),T=async()=>{try{Q.value=await $()}catch(e){console.log("请求绘画示例失败=>",e)}};T();const P=()=>{V({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{var t;(null==(t=null==e?void 0:e.tempFiles[0])?void 0:t.size)>10485760?uni.$u.toast("请上传10m以下的图片"):L(e.tempFilePaths[0])}})},L=async e=>{K({title:"上传中"});try{const t=await S(e,{type:"draw"});p.formData.image_base=t.path,Y()}catch(t){Y(),uni.$u.toast(t),console.log("上传图片失败",t)}},Z=()=>{p.formData.action="generate",console.log(p.formData),i("drawing",{drawing:p.formData,isClear:!0})};return(e,a)=>{const i=d,b=g,k=y(_("u-loading"),oe),D=v,E=y(_("u-icon"),ne),R=y(_("l-textarea"),fe),U=j,V=B,K=y(_("u-button"),ie);return l(),r(b,{class:"h-full flex flex-col"},{default:s((()=>[o(b,{class:"flex-1 min-h-0"},{default:s((()=>[o(V,{class:"h-full","scroll-y":!0},{default:s((()=>[o(b,{class:"h-full p-[30rpx] relative"},{default:s((()=>[o(b,{class:"flex justify-between"},{default:s((()=>[o(b,{class:"text-base"},{default:s((()=>[o(i,{class:"font-medium"},{default:s((()=>[c(" 文本描述 ")])),_:1}),o(i,{class:"text-error"},{default:s((()=>[c("*")])),_:1})])),_:1})])),_:1}),o(b,{class:"mt-[24rpx]"},{default:s((()=>[o(R,{modelValue:t.formData.prompt,"onUpdate:modelValue":a[2]||(a[2]=e=>t.formData.prompt=e),maxlength:"1024",rows:5,"show-word-limit":!1,"custom-class":{paddingBottom:"60rpx"},placeholder:"输入英文描述词，生成效果会更好；描述词越详细，生成的图片效果更加真实哦～"},{"length-suffix":s((()=>[o(b,{class:"length-suffix justify-end text-sm"},{default:s((()=>{var n,u;return[o(b,{class:"text-primary",onClick:a[0]||(a[0]=e=>{var t;return null==(t=F(x))?void 0:t.open()})},{default:s((()=>[c(" 描述词推荐 ")])),_:1}),2==(null==(u=null==(n=F(f))?void 0:n.getDrawConfig)?void 0:u.translate_type)?(l(),r(b,{key:0,class:"ml-[40rpx] text-muted hover:text-primary",loading:F(z),onClick:I(F(H),["stop"])},{default:s((()=>[F(z)?(l(),r(k,{key:0,mode:"flower",color:e.$theme.primaryColor,size:"28"},null,8,["color"])):(l(),r(D,{key:1,class:"w-[26rpx] h-[26rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAxJJREFUaEPtmD9oFEEUxt83F0kfECSC2AiChQgWFhaKWCiKBGLEwj/HuTNZE0Q74wlpNIoICjHZmbsT/IMoESFoQAtRa0UQFEQQNKVYKNgZdkYWspI7d5ObzWTPg9vyZt77vt97e7O7D9TmF9rcP3UAWt3BTgdsOlCr1XrCMCwC+MQ5n7GJTdubWweCIFjPGPsSGzHGTIVhWB4aGvq8HJDcAKSUHIBqMDsLoMw5v5cVIjeAyKBSyiQZBTBeKBTKpVLply1IrgBSyq0A3qRAvCaiqBvPbSByBYiNKaXuENGRFKPnhRAXm4VoCUBkTkq5C0BitY0xMwDOCSHeLwXSMoDYmJRyGsCBBKPftdZl3/eri0G0HGC+G0cB3E75b9yMTirP874lri/VorzWgyBYyxi7S0Q7EzQ/zB+3jxvX/osOLDQlpRwBMJZSuDEhRHnhWh2AlHICwEEiWp1X5TPoPBRCDMRxfwGCINjBGHuZIWHuIQD2cs6fRsJtCaC1Lvq+f6sOYP40aIdbqKK1vuT7/td/AHK/FxwI/nenkC1TB8C2Yq73dzrguqK2+TodsK2Y6/11HQiC4DhjbD+AHtdCrvJpre93d3dPFYvFn42vEnVjD1eCK5SnTwgxXQdQqVT2GWOerJCg67RnhBDXk96FagBKrtVc5jPGvGWMneCcv0sC2MAYmzDG7E4RPam1/ujSkG0u3/dfLYxJPEaVUtFXz4WU5M+6uroGsgyhbM02sz/1OaCU2k5EN4hoc1Iixtgxz/Oi+U5Lr0UfZEqpVUR0lYhOpbh8JITobyVBU0/iarXaH4bhOIA1jWYB/Aawx/O8F60AaQogMqaUWkdEV4joUJJRY0x1cHCQ5w3RNEBsTCkV3U7XiIglmP0xNze3ZXh4eDYvEGuAyNjk5OS2QqEQzW6ShlAkhMiUNwt0ZqHR0VHW29sbTZHPJgiPCCEuZzFkG5MZIBaqVCp9xpioGxvj3wAc5pw/sDWTZf+yASLRaK4J4DSATVrrqXhmk8WQbYwTAFtRl/s7AC6rmSVXpwNZquYy5g8z9Ncxp/yLngAAAABJRU5ErkJggg=="})),o(i,{class:"ml-[10rpx]"},{default:s((()=>[c("翻译成英文")])),_:1})])),_:1},8,["loading","onClick"])):m("",!0),o(b,{class:"cursor-pointer text-muted hover:text-primary ml-[40rpx]",onClick:a[1]||(a[1]=I((e=>t.formData.prompt=""),["stop"]))},{default:s((()=>[o(E,{name:"trash"}),o(i,null,{default:s((()=>[c("清空")])),_:1})])),_:1})]})),_:1})])),_:1},8,["modelValue"])])),_:1}),o(b,{class:"flex justify-between mt-[20rpx] text-base"},{default:s((()=>[o(b,{class:"flex items-center cursor-pointer text-muted",onClick:T},{default:s((()=>[o(b,{class:"flex items-center text-[#8e8e8e] hover:text-primary"},{default:s((()=>[o(E,{name:"reload"}),o(i,{class:"text-muted ml-[10rpx]"},{default:s((()=>[c("随便试试")])),_:1})])),_:1}),o(b,{class:"ml-[10rpx] text-black truncate w-[500rpx]"},{default:s((()=>[(l(!0),h(w,null,C(Q.value,((e,t)=>(l(),r(i,{class:"ml-[20rpx]",key:t,onClick:I((t=>{return a=e.promptEn,void(p.formData.prompt=a);var a}),["stop"])},{default:s((()=>[c(u(e.prompt),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),o(b,{class:"cursor-pointer flex items-center"})])),_:1}),o(b,{class:"mt-[40rpx]"},{default:s((()=>[o(b,{class:"text-base font-medium"},{default:s((()=>[c("上传参考图")])),_:1}),o(b,{class:"uploader mt-[20rpx] flex justify-center items-center",onClick:P},{default:s((()=>[t.formData.image_base?(l(),r(b,{key:1,class:"w-full h-full relative text-center has_image",onClick:a[4]||(a[4]=I((()=>{}),["stop"]))},{default:s((()=>[o(E,{class:"has_img_delete",name:"close-circle-fill",color:"#ffffff",size:"40",onClick:a[3]||(a[3]=I((e=>t.formData.image_base=""),["stop"]))}),o(D,{class:"w-full h-full",src:t.formData.image_base,mode:"aspectFit"},null,8,["src"]),o(b,{class:"has_img_btn",onClick:P},{default:s((()=>[c("换图")])),_:1})])),_:1})):(l(),r(b,{key:0,class:"flex flex-col justify-center items-center"},{default:s((()=>[o(D,{class:"w-[72rpx] h-[72rpx] mb-[12rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAABW5JREFUeF7tnE+IHEUUxt+DBkkOexNFc/IiKIg5CQpecpMQL9lAUCTxGhiYmp3DnpxcAz3N7iG3+Achh4QInjx48eAhAUFzSAjBm2iIFyULIQs7XaFhFtch213TO/X6db1vr1PV773v+9Xr6pnaZsKfaQXYdPUongCAcQgAAAAwroDx8tEBAIBxBYyXjw4AAIwrYLx8dAAAYFwB4+WjAwAA4woYLx8dAAAYV8B4+egAAMC4AsbLRwcAAMYVMF4+OgAAMK6A8fLRAQCAcQWMl48OAACMK2C8fHQAAGBcAePlowMAAOMKGC8fHQAAGFfAePnoAADAngLb29tv7e3tTYhonYjuMfOPRHR5OBz+a00Ncx1gbv4NInp7wezfsiz7ZDAY3LcEgSkAaszf9/xelmXnLEFgBoAA801CYAKAJcw3B0HyALQw3xQESQNwBPPNQJAsACsw3wQESQKwQvOThyA5ACKYnzQESQEQ0fxkIUgGAAHzk4QgCQAEzU8Ogt4DMJlMjq+trf1MRCcDvsPfJaKXGsaFjKkucTfLsvcGg0E1vrd/vQcgz/MJM38R4MATZr7ovb9VN9Z7f5aZvySitYBrXnXOXQoYp3ZICgBcZ+bzDQr/zcwXhsPhD9Pp1NeNdc5xnuen5xC83HDdZ865Y2rdDUis9wAURfGV9/5CTa1/zGazz8bj8U/VmBAAqnFbW1unyrL82nt/oubaD51zbwborHZICgB87r2/dojCv89ms0/H4/Gd/c9DAajG53n+PjN/S0RvHHL9W865s2rdDUis9wDMjXrRPuBX7/3F0Wh096AOywBQzSuK4l0i+sZ7/86Cnrd3d3c/2tzc/CdAZ7VDkgBgDsE6M6977/eI6OHOzs6VyWTydFH5ZQGY3zZeJ6JtIvqAiB4R0c2yLL/b2Nh4oNbZwMSSASCw3uA9QOj1+j4OACw4WD0F9N3UZfI3VewyTwHLiNjnsQAAHUCG3+l0Wh3F/pCIXqmLyMx/lWX5y2g0+jhGZm02gavIQ0v9i7WIdIAm0Q8TOMb9uCmXLmJK1i8OQJ7n3zPzmZar6KZz7lzLuS+cJg2AtvrFASiK4k/v/WstTXzsnHu15VwVAGirXxyAphXXYK51ACjGLemg5tH3AEcEwPotwDYAMehvArKLmHVdMEY+qjuA9cfARRiSByB2gYuCdtEB6lZ41/l0vgcAAM0nlFb5FKTuKQAAAIDoXegg9V23XG23pOjiQ/D6Bt61PgCg418DAYDwAYyuBcctwPiKAwAA4H8KdN2RsAcwDiQAAAAxv2cK/1esuFn8d/WuWy72AB2vuIYDGis/f9AEdtdAmrsFNBzRWvn5AwAQ8O/YTSKt+vPDVp307xJVXegAwl8E7cO0f0ybmWcxj6E3wQsAOgKgyRipzwEAAGh8Y0lMGM1tAmOK2eba6ADoAOgAbVZOKnPQAdAB0AFSWc1t6kAHQAew3QHarBpLc2J/O9n5Y6AlM9vUCgDaqJbQHACQkJltSuk9AEd8QUIbzVKaE/18QvQ9wBFfkZKSmW1qiX4+IToAIb95t1HGwpzY7b/SUASAOQRBr4mzYGxdjbHfj7AYWwwA68ZqrR8AaHVGKC8AICS01jAAQKszQnkBACGhtYYBAFqdEcoLAAgJrTUMANDqjFBeAEBIaK1hAIBWZ4TyAgBCQmsNAwC0OiOUFwAQElprGACg1RmhvACAkNBawwAArc4I5QUAhITWGgYAaHVGKC8AICS01jAAQKszQnkBACGhtYYBAFqdEcoLAAgJrTUMANDqjFBeAEBIaK1hAIBWZ4TyAgBCQmsNAwC0OiOUFwAQElprGACg1RmhvACAkNBawwAArc4I5fUcaJDBn3f6FnEAAAAASUVORK5CYII="}),o(b,{class:"text-muted"},{default:s((()=>[c("点击上传参考图")])),_:1})])),_:1}))])),_:1})])),_:1}),o(b,{class:"mt-[40rpx] pb-[20px]"},{default:s((()=>[o(b,{class:"text-base font-medium"},{default:s((()=>[c("图片尺寸")])),_:1}),o(b,{class:"flex justify-between flex-wrap"},{default:s((()=>[(l(!0),h(w,null,C(G.lists,((e,t)=>(l(),r(b,{key:t,class:n(["picture-size mt-[20rpx] rounded-[8rpx] text-center",{"picture-size-active":G.current==t}]),onClick:e=>G.current=t},{default:s((()=>[o(b,{class:"flex justify-center mt-[30rpx]"},{default:s((()=>[o(D,{class:"w-[36rpx] h-[36rpx]",src:e.icon},null,8,["src"])])),_:2},1024),5!=t?(l(),r(b,{key:0,class:"text-xl mt-[8rpx]"},{default:s((()=>[c(u(e.widthRatio)+":"+u(e.heightRatio),1)])),_:2},1024)):(l(),r(b,{key:1,class:"flex justify-center text-xl mt-[10rpx]"},{default:s((()=>[o(U,{modelValue:e.widthRatio,"onUpdate:modelValue":t=>e.widthRatio=t,class:"input-ratio w-7 text-center",type:"number",min:"0",max:"50"},null,8,["modelValue","onUpdate:modelValue"]),o(i,{class:"mx-[6rpx]"},{default:s((()=>[c(" : ")])),_:1}),o(U,{modelValue:e.heightRatio,"onUpdate:modelValue":t=>e.heightRatio=t,class:"input-ratio w-7 text-center",type:"number",min:"0",max:"50"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)),o(b,{class:"text-base mt-[4px]"},{default:s((()=>[c(u(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),o(b,{class:"mt-[20rpx] pb-[50px]"},{default:s((()=>[o(b,{class:"text-base mb-[20rpx]"},{default:s((()=>[c("其它参数")])),_:1}),o(me,{type:"text","cursor-spacing":120,modelValue:t.formData.other,"onUpdate:modelValue":a[5]||(a[5]=e=>t.formData.other=e),placeholder:"请输入后缀参数",customStyle:{padding:"0 20rpx",borderRadius:"14rpx",backgroundColor:"#f5f5f5"}},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),o(b,{class:"bg-white z-10 w-full p-[20rpx]"},{default:s((()=>[A(e.$slots,"model",{},void 0,!0),o(K,{type:"primary","custom-style":{width:"100%",height:"82rpx",fontSize:"30rpx",margin:"0"},shape:"circle",onClick:I(Z,["stop"])},{default:s((()=>[c(" 立即生成 ")])),_:1},8,["onClick"])])),_:3}),o(he,{ref_key:"keywordSuggestionRef",ref:x,modelValue:t.formData.prompt,"onUpdate:modelValue":a[6]||(a[6]=e=>t.formData.prompt=e)},null,8,["modelValue"])])),_:3})}}}),[["__scopeId","data-v-3c9efb33"]]),Ce=f({__name:"model-picker",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const a=E({show:!1,current:{balance:1,name:"",key:""},modelList:[]}),r=e=>{a.current=a.modelList[e[0]],t("update:modelValue",a.current.key)};return(async()=>{try{const e=await te();a.modelList=e,a.current=e.find((e=>e.default))||e[0],t("update:modelValue",a.current.key)}catch(e){console.log("获取绘画模型失败=>",e)}})(),(e,t)=>{const n=d,i=y(_("u-icon"),ne),A=g,p=y(_("u-picker"),Ae);return l(),h(w,null,[a.modelList.length?(l(),h("div",{key:0,class:"flex items-center justify-between pb-[20rpx] text-xs"},[o(A,{class:"inline-flex justify-center items-center rounded-[30px] h-[60rpx] px-[24rpx]",style:{"box-shadow":"0 2px 6px 0 rgba(0, 0, 0, 0.1)"},onClick:t[0]||(t[0]=e=>a.show=!0)},{default:s((()=>[o(n,{class:"text-[#415058] mr-[6px]"},{default:s((()=>[c(u(a.current.name),1)])),_:1}),o(i,{name:"arrow-down",size:"24rpx"})])),_:1}),o(A,{class:"ml-[10px] text-[#999999]"},{default:s((()=>[o(n,null,{default:s((()=>[c("消耗 ")])),_:1}),o(n,{class:"text-primary"},{default:s((()=>{var e;return[c(u((null==(e=null==a?void 0:a.current)?void 0:e.balance)||0),1)]})),_:1}),o(n,null,{default:s((()=>[c("条绘画条数")])),_:1})])),_:1})])):m("",!0),o(p,{modelValue:a.show,"onUpdate:modelValue":t[1]||(t[1]=e=>a.show=e),"safe-area-inset-bottom":!0,"confirm-color":e.$theme.primaryColor,mode:"selector",range:a.modelList,"range-key":"name",onConfirm:r},null,8,["modelValue","confirm-color","range"])],64)}}}),ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAQAAACROWYpAAACxElEQVR42o3UX4iNWxjH8e+z3sWc6Jw659RxuDKn06nD6ZzD5MLNmOFGUsyk5MIFep+NSBQlVyJx54Ky13tBSlz4H+FGEUWaK9MQMoZQLlyRGXu/6yGz2+39jr35rN6bVb/Wu9Z6niUlKZuuYzN/MgWjlchrrtru7KW6EKkR0INsIeJozxBGbGk2mLqsFhdNCcAJjltOK0KU/9nO7wzI/HJFJRgAek9Nj4M62lAH2q1jatoP2pEKgGM2cAqYlCapV89XhahJuMkVoAvIhdSBpwNsDKxKTPiA9rCQn8kRmjkdpRNYrI7Hdj57mzoPgIBIMP2p4xh9GEJrc5mDyF5dFW6Mh41xR+mjwh1G8BgTJTiqeHqYzpm0t77HUNWF9APbwqGSK0daSCWz9C+5Sqfs8lDXDdwKhza4PGl39pqER7qfMt2N4V+BF5C7UGlcyRDJYsOMgT0V+M01lSAIBZlFlxtFBoijONkgdZDO9o/8Dig5KHK0IQ6kmz9YDuWYCgW+TUE6PFUcYGuSyWKiFqrfFQ6RqAAVwI7mFLQMqwTTv1lEru/pBaZrCZjMSLj4zXCwlcJJ/qt3eSdHgIhLF2XXScjbhL+8LieBUXJmMJN3DGFM4hUPgUh9ZQMSmpQNwgEOqA9V3chhBsP88cJsvk7Hc5B/Jl5bvUCt9pFZyak07/ka69mhd8NtrND+ggAJkPTLDD5KsV2c7WGYaVzTMyxo3kAwi2DDwJuzVpEQKXDZK5YxyFT6mFX89SyH7LL1sAnMaCQAXl24X5pnS/mXJXQRoSi7ARBsYg/4ENUxxrlwWqfQhQeS1GiUYETqxJPLVOCDrx2NJ+cB0KuzwpC6pv3lNNkQgdXAkFAvyPQXGWAmT9hnz0iwls9/B2tZAahQv9cQtZcL/IghtBdxHAxbE2oG7HN8uOsS0z6PH7CWA0Z5yM6wvySfABTwHNHdRSKKAAAAAElFTkSuQmCC",_e=f({__name:"drawing-loading",setup:e=>(e,t)=>{const a=y(_("u-loading"),oe),n=g;return l(),r(n,{class:"flex flex-col justify-center items-center w-[500rpx] h-[500rpx] px-[50rpx] bg-page"},{default:s((()=>[o(a,{mode:"circle",color:e.$theme.primaryColor,size:"40"},null,8,["color"]),o(n,{class:"text-primary text-sm mt-[20rpx]"},{default:s((()=>[c(" 正在生成中 ")])),_:1})])),_:1})}}),ve=f({__name:"drawing-status",props:{content:{default:""}},setup:e=>(t,a)=>{const n=v,i=g;return l(),r(i,{class:"h-full flex flex-col justify-center items-center"},{default:s((()=>[o(n,{class:"w-[300rpx] h-[300rpx]",src:xe}),o(i,{class:"text-muted text-center mt-[30px]"},{default:s((()=>[c(u(e.content),1)])),_:1})])),_:1})}}),Be=t(f({__name:"drawing-picture",props:{picture:{default:""}},emits:["preview"],setup(e,{emit:t}){const a=(e,a)=>{e?G({current:a,urls:e}):t("preview")};return(t,n)=>{const i=y(_("u-loading"),oe),u=g,m=y(_("u-image"),pe);return l(),h("div",{class:"preview-picture"},[Array.isArray(e.picture)?(l(!0),h(w,{key:1},C(e.picture,((t,s)=>(l(),r(m,{class:"image__item",width:"240",mode:"widthFix",key:s,src:t,onClick:t=>a(e.picture,s)},null,8,["src","onClick"])))),128)):(l(),r(m,{key:0,src:e.picture,width:"500",height:"100%",mode:"widthFix",onClick:a},{loading:s((()=>[o(u,{class:"flex flex-col justify-center items-center w-full h-[500rpx] bg-[#F7F9FD]"},{default:s((()=>[o(i,{mode:"circle",color:t.$theme.primaryColor,size:"40"},null,8,["color"]),o(u,{class:"text-primary text-sm mt-[20rpx]"},{default:s((()=>[c(" 加载中 ")])),_:1})])),_:1})])),_:1},8,["src"]))])}}}),[["__scopeId","data-v-ef951ac1"]]),Qe=t(f({__name:"drawing-record",props:{current:{default:0},contentList:{default:[]},formData:{default:{actions:[],prompt:"",prompt_en:"",progress:0,task_id:"",image_id:"",imageUrl:""}}},emits:["change","drawing","delete","split","update:current","update:modelValue"],setup(t,{emit:a}){const i=t,A=e(""),p=async e=>{try{const{copy:t}=ge();await t(e),uni.$u.toast("复制成功")}catch(t){uni.$u.toast("复制失败"),console.log("复制失败",t)}},f=(e,t)=>{const l=e;l.action="upsample"+t,a("drawing",{drawing:l})},x=(e,t)=>{const l=e;l.action="variation"+t,a("drawing",{drawing:l})};return(e,Q)=>{const b=y(_("u-loading"),oe),k=g,D=v,E=y(_("u-image"),pe),R=B,F=d,I=y(_("u-icon"),ne);return l(),r(R,{class:"h-full","scroll-y":!0,"scroll-into-view":A.value},{default:s((()=>[t.contentList.length?(l(),h(w,{key:1},[o(R,{class:"whitespace-nowrap",id:"recordList","scroll-x":!0},{default:s((()=>[o(k,{class:"py-[30rpx] inline-block"},{default:s((()=>[(l(!0),h(w,null,C(t.contentList,((i,u)=>(l(),r(k,{key:u,class:n(["record-item",{"record-item_active":u==t.current}]),onClick:e=>((e,t)=>{a("change",e),a("update:current",t)})(i,u)},{default:s((()=>[o(E,{src:i.thumbnail,width:"160",height:"160"},{error:s((()=>[1===i.status?(l(),r(k,{key:0,class:"flex flex-col justify-center items-center bg-page w-full h-full"},{default:s((()=>[o(b,{mode:"circle",color:e.$theme.primaryColor,size:"40"},null,8,["color"]),o(k,{class:"text-primary text-sm mt-[10rpx]"},{default:s((()=>[c(" 生成中... ")])),_:1})])),_:1})):(l(),r(D,{key:1,class:"w-[160rpx] h-[160rpx]",src:"/mobile/assets/error-e1bd19d8.png"}))])),_:2},1032,["src"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),o(k,{class:"flex justify-center items-center w-full mt-[20rpx]"},{default:s((()=>[3===t.formData.status?(l(),r(Be,{key:0,picture:t.formData.imageUrl,onPreview:Q[0]||(Q[0]=e=>(e=>{const t=e.map((e=>e.imageUrl));G({current:i.current,urls:t})})(t.contentList))},null,8,["picture"])):m("",!0),1===t.formData.status?(l(),r(_e,{key:1})):m("",!0),2===t.formData.status?(l(),r(ve,{key:2,content:t.formData.failReason},null,8,["content"])):m("",!0)])),_:1}),3===t.formData.status?(l(),r(k,{key:0,class:"pb-[60px]"},{default:s((()=>[o(k,{class:"drawing-property"},{default:s((()=>{var e,n,i,d;return[o(k,null,{default:s((()=>[o(k,{class:"my-[8rpx]",onClick:Q[1]||(Q[1]=e=>p(t.formData.prompt))},{default:s((()=>[o(F,{class:"text-base"},{default:s((()=>[c("原始关键词")])),_:1}),o(D,{class:"w-[30rpx] h-[30rpx] ml-[16rpx]",src:ye})])),_:1}),o(k,{class:"px-[20rpx] py-[12rpx] bg-page rounded-[6rpx] text-base max-h-[240rpx] overflow-y-auto"},{default:s((()=>[c(u(t.formData.prompt),1)])),_:1})])),_:1}),t.formData.promptEn?(l(),r(k,{key:0},{default:s((()=>[o(k,{class:"my-[8rpx]",onClick:Q[2]||(Q[2]=e=>p(t.formData.promptEn))},{default:s((()=>[o(F,{class:"text-base"},{default:s((()=>[c("英文关键词")])),_:1}),o(D,{class:"w-[30rpx] h-[30rpx] ml-[16rpx]",src:ye})])),_:1}),o(k,{class:"px-[20rpx] py-[12rpx] bg-page rounded-[6rpx] text-base max-h-[240rpx] overflow-y-auto"},{default:s((()=>[c(u(t.formData.promptEn),1)])),_:1})])),_:1})):m("",!0),-1===(null==(n=null==(e=t.formData)?void 0:e.action)?void 0:n.indexOf("upsample"))?(l(),r(k,{key:1,class:"mt-[30rpx]"},{default:s((()=>[o(k,{class:"mt-[8rpx]"},{default:s((()=>[o(F,{class:"text-base"},{default:s((()=>[c("放大图片")])),_:1}),o(F,{class:"text-xs text-muted ml-[16rpx]"},{default:s((()=>[c(" 对上面的其中一张图片进行放大 ")])),_:1})])),_:1}),o(k,{class:"flex justify-between mt-[20rpx]"},{default:s((()=>[o(k,{class:"property__btn",onClick:Q[3]||(Q[3]=e=>f(t.formData,1))},{default:s((()=>[c(" 左上 ")])),_:1}),o(k,{class:"property__btn",onClick:Q[4]||(Q[4]=e=>f(t.formData,2))},{default:s((()=>[c(" 右上 ")])),_:1}),o(k,{class:"property__btn",onClick:Q[5]||(Q[5]=e=>f(t.formData,3))},{default:s((()=>[c(" 左下 ")])),_:1}),o(k,{class:"property__btn",onClick:Q[6]||(Q[6]=e=>f(t.formData,4))},{default:s((()=>[c(" 右下 ")])),_:1})])),_:1})])),_:1})):m("",!0),-1===(null==(d=null==(i=t.formData)?void 0:i.action)?void 0:d.indexOf("upsample"))?(l(),r(k,{key:2,class:"mt-[30rpx]"},{default:s((()=>[o(k,{class:"mt-[8rpx]"},{default:s((()=>[o(F,{class:"text-base"},{default:s((()=>[c("变体图片")])),_:1}),o(F,{class:"text-xs text-muted ml-[16rpx]"},{default:s((()=>[c(" 对上面的其中一张图片进行多样化修改 ")])),_:1})])),_:1}),o(k,{class:"flex justify-between mt-[20rpx]"},{default:s((()=>[o(k,{class:"property__btn",onClick:Q[7]||(Q[7]=e=>x(t.formData,1))},{default:s((()=>[c(" 左上 ")])),_:1}),o(k,{class:"property__btn",onClick:Q[8]||(Q[8]=e=>x(t.formData,2))},{default:s((()=>[c(" 右上 ")])),_:1}),o(k,{class:"property__btn",onClick:Q[9]||(Q[9]=e=>x(t.formData,3))},{default:s((()=>[c(" 左下 ")])),_:1}),o(k,{class:"property__btn",onClick:Q[10]||(Q[10]=e=>x(t.formData,4))},{default:s((()=>[c(" 右下 ")])),_:1})])),_:1})])),_:1})):m("",!0),o(k,{class:"mt-[30rpx]"},{default:s((()=>[o(k,{class:"mt-[8rpx]"},{default:s((()=>[o(F,{class:"text-base"},{default:s((()=>[c("更多操作")])),_:1})])),_:1}),o(k,{class:"flex flex-wrap mt-[20rpx]"},{default:s((()=>{var e,n,i,u;return[o(k,{class:"property__btn !px-[40rpx] mb-[20rpx] mr-[20rpx]",onClick:Q[11]||(Q[11]=e=>{return a=t.formData,void(Array.isArray(a.imageUrl)?uni.$u.toast("请点击自己想要保存的图片后长按保存～"):de(a.imageUrl));var a})},{default:s((()=>[o(I,{name:"download"}),o(F,{class:"ml-[10rpx]"},{default:s((()=>[c("下载")])),_:1})])),_:1}),-1===(null==(n=null==(e=t.formData)?void 0:e.action)?void 0:n.indexOf("upsample"))?(l(),r(k,{key:0,class:"property__btn !px-[40rpx] mb-[20rpx] mr-[20rpx]",onClick:Q[12]||(Q[12]=e=>(async e=>{A.value="recordList",a("split",e.imageUrl),await N(),A.value=""})(t.formData))},{default:s((()=>[o(I,{name:"edit-pen"}),o(F,{class:"ml-[10rpx]"},{default:s((()=>[c("一键切图")])),_:1})])),_:1})):m("",!0),(null==(u=null==(i=t.formData)?void 0:i.actions)?void 0:u.length)&&t.formData.able_edit?(l(),r(k,{key:1,class:"property__btn !px-[40rpx] mb-[20rpx] mr-[20rpx]",onClick:Q[13]||(Q[13]=e=>(async e=>{const t={action:"generate"};t.prompt=e.prompt,t.image_id="",t.scale=e.scale,t.image_base=e.imageBase,console.log("重新生成"),a("drawing",{drawing:t})})(t.formData))},{default:s((()=>[o(I,{name:"reload"}),o(F,{class:"ml-[10rpx]"},{default:s((()=>[c("重新生成")])),_:1})])),_:1})):m("",!0),o(k,{class:"property__btn !px-[40rpx] mb-[20rpx] mr-[20rpx]",onClick:Q[14]||(Q[14]=e=>(async e=>{(await z({title:"温馨提示",content:"是否删除当前绘画?",confirmColor:"#FFC94D"})).confirm&&a("delete",e.id)})(t.formData))},{default:s((()=>[o(I,{name:"trash"}),o(F,{class:"ml-[10rpx]"},{default:s((()=>[c("删除")])),_:1})])),_:1})]})),_:1})])),_:1})]})),_:1})])),_:1})):m("",!0)],64)):(l(),r(ve,{key:0,content:"暂无生成记录"}))])),_:1},8,["scroll-into-view"])}}}),[["__scopeId","data-v-24b80f98"]]),be=t(f({__name:"drawing",setup(t){const a=U(),n=k(),i=b(),c=E({current:0,lists:[{name:"AI绘画",value:0},{name:"生成记录",value:0}]}),u=e(!1),m=e(""),A=e([]),p=E({current:0,lists:[]}),d=E({actions:[],prompt:"",promptEn:"",failReason:"",status:"",other:"",taskId:"",imageId:"",imageUrl:""}),f={prompt:"",action:"generate",image_base:"",other:"",image_id:"",scale:"1:1"},x=E({...f}),C=e=>{c.current=e},{start:v,end:B}=(()=>{const t=async()=>{await D(),p.current=0,await i.getUser()},{start:a,end:l,result:r}=function(t,a){const l=e(null),r=e(null),{time:s=2e3,totalTime:o,count:n,callback:i=(()=>!1)}=a??{};let c=null,u=null,m=0;const A=()=>(console.log("count2:",n),u&&u<=Date.now()||n&&m>=n?(p(),void i()):(m++,void(c=setTimeout((()=>{t().then((e=>{l.value=e,A()})).catch((e=>{r.value=e}))}),s)))),p=()=>{setTimeout((()=>{clearTimeout(c),c=null,u=null,m=0}),0)};return{start:()=>{u=o?Date.now()+o:null,A()},end:p,error:r,result:l}}((async()=>{try{const e=await se(A.value);return e.filter((e=>3==e.status||2==e.status)).length&&(l(),t()),e}catch(e){l(),console.log("获取详情失败=>",e)}}),{totalTime:48e4,time:5e3,count:96,callback:t});return{start:a,end:l,result:r}})();H((()=>{B()})),T((()=>{B()}));const Q=e=>{Reflect.ownKeys(e).map((t=>{d[t]=e[t]}))},D=async()=>{try{const e=await ae({});0!=e.length&&Reflect.ownKeys(e[0]).map((t=>{d[t]=e[0][t]})),p.lists=e,A.value=R(),A.value.length&&(c.current=1,v())}catch(e){console.log("获取绘画记录失败=>",e)}},R=()=>p.lists.filter((e=>1===e.status)).map((e=>e.id)),I=async e=>{try{await le({ids:[e]}),await D()}catch(t){console.log("删除绘画记录失败=>",t)}},V=async e=>{if(!u.value&&!Array.isArray(d.imageUrl)){K({title:"切图中"}),u.value=!0;try{const{getImages:t}=((e,t)=>{const{columns:a,rows:l}=t;if(!e)throw Error("请传入图片地址");if(!a&&!l)throw Error("请传入columns和rows");const r=async(e,t,a)=>{const l=document.createElement("canvas");l.width=e,l.height=t;const r=l.getContext("2d");return r.drawImage(a,0,0,e,t),s(r)},s=e=>{const t=e.canvas.width/a,r=e.canvas.height/l,s=[];for(let n=0;n<l;n++){const l=[];for(let s=0;s<a;s++){const a=o(e,s*t,n*r,t,r);l.push(a)}s.push(...l)}return s},o=(e,t,a,l,r)=>{const s=document.createElement("canvas");s.width=l,s.height=r;const o=e.getImageData(t,a,l,r);return s.getContext("2d").putImageData(o,0,0),s.toDataURL("image/png",1)};return{getImages:()=>new Promise(((t,a)=>{const l=new Image;l.setAttribute("src",e+"?"+(new Date).getTime()),l.setAttribute("crossOrigin",""),l.onload=()=>{t(r(l.width,l.height,l))},l.onerror=e=>{a(e)}}))}})(e,{columns:2,rows:2}),a=await t();d.imageUrl=a,u.value=!1,Y()}catch(t){Y(),u.value=!1,uni.$u.toast("下载图片超时，请重试"),console.log("一键切图失败=>",t)}}},S=async e=>{if(!i.isLogin)return a.navigateTo("/pages/login/login");if(!e.drawing.prompt)return uni.$u.toast("请输入绘画描述！");c.current=1,p.current=0,d.imageUrl=null,d.status=1,d.thumbnail=null,p.lists.unshift({...d});try{B();const{id:t}=await re({...e.drawing,model:m.value});if(e.isClear){let e=x.scale;Object.assign(x,f),x.scale=e,e=null}p.lists[0].id=t,A.value.push(t),v()}catch(t){if(c.current=0,d.status=0,p.lists.splice(0,1),p.current=-1,"余额不足"===t)return void j();console.log("绘制失败=>",t),d.failReason=t,await D()}},j=async()=>{(await z({title:"绘画余额不足",content:"绘画余额不足，请前往充值",confirmText:"前往充值"})).confirm&&(i.isLogin?a.navigateTo("/packages/pages/recharge/recharge"):a.navigateTo("/pages/login/login"))};return P((()=>{D()})),(e,t)=>{const a=y(_("page-meta"),O),i=y(_("u-empty"),M),u=y(_("tabbar"),J),A=g,f=y(_("u-tabs"),W);return l(),h(w,null,[o(a,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),F(n).getDrawConfig.is_open?(l(),r(A,{key:1,class:"drawing-container"},{default:s((()=>[o(f,{list:c.lists,"is-scroll":!0,current:c.current,"active-color":e.$theme.primaryColor,"bg-color":"transparent",barStyle:{background:e.$theme.primaryColor},onChange:C},null,8,["list","current","active-color","barStyle"]),o(A,{class:"drawing-content"},{default:s((()=>[L(o(A,{class:"h-full"},{default:s((()=>[o(we,{class:"h-full",formData:x,onDrawing:S},{model:s((()=>[o(Ce,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e)},null,8,["modelValue"])])),_:1},8,["formData"])])),_:1},512),[[Z,0==c.current]]),L(o(A,{class:"h-full"},{default:s((()=>[o(Qe,{class:"h-full",current:p.current,"onUpdate:current":t[1]||(t[1]=e=>p.current=e),formData:d,contentList:p.lists,onChange:Q,onDrawing:S,onDelete:I,onSplit:V},null,8,["current","formData","contentList"])])),_:1},512),[[Z,1==c.current]])])),_:1}),o(u)])),_:1})):(l(),r(A,{key:0,class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},{default:s((()=>[o(i,{text:"绘画功能未开启",mode:"favor"}),o(u)])),_:1}))],64)}}}),[["__scopeId","data-v-4880e39c"]]);export{be as default};
